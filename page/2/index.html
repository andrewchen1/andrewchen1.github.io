<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.andrewchen1.top","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="å°å¤«çš„ç¬”è®°">
<meta property="og:url" content="https://blog.andrewchen1.top/page/2/index.html">
<meta property="og:site_name" content="å°å¤«çš„ç¬”è®°">
<meta property="og:locale">
<meta property="article:author" content="å°å¤«">
<meta property="article:tag" content="ç¬”è®°">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://blog.andrewchen1.top/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>å°å¤«çš„ç¬”è®°</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">å°å¤«çš„ç¬”è®°</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">ä½†è¡Œå¥½äº‹ è«é—®å‰ç¨‹</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.andrewchen1.top/2019/08/24/Java-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%864/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="å°å¤«">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¤«çš„ç¬”è®°">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/24/Java-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%864/" class="post-title-link" itemprop="url">Java-åŸºç¡€çŸ¥è¯†ç‚¹æ•´ç†4</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-24 13:50:41" itemprop="dateCreated datePublished" datetime="2019-08-24T13:50:41+08:00">2019-08-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-30 22:04:37" itemprop="dateModified" datetime="2020-08-30T22:04:37+08:00">2020-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">JavaåŸºç¡€çŸ¥è¯†</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Javaå¼‚å¸¸åˆ†ç±»å’Œå¤„ç†"><a href="#Javaå¼‚å¸¸åˆ†ç±»å’Œå¤„ç†" class="headerlink" title="Javaå¼‚å¸¸åˆ†ç±»å’Œå¤„ç†"></a>Javaå¼‚å¸¸åˆ†ç±»å’Œå¤„ç†</h1><h2 id="Javaæ³¨è§£"><a href="#Javaæ³¨è§£" class="headerlink" title="Javaæ³¨è§£"></a>Javaæ³¨è§£</h2><ul>
<li><p>@Target</p>
<p>è¡¨ç¤ºè¿™ä¸ªæ³¨è§£ä½¿ç”¨çš„èŒƒå›´</p>
</li>
<li><p>@Retention</p>
<p>è¡¨ç¤ºè¿™ä¸ªæ³¨è§£çš„å­˜æ´»æ—¶é—´èŒƒå›´ã€‚æ¯”æ–¹è¯´æ˜¯</p>
<blockquote>
<p>ä½œè€…ï¼šRednaxelaFX</p>
<p>é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/60835139/answer/180750670">https://www.zhihu.com/question/60835139/answer/180750670</a></p>
<p>æ¥æºï¼šçŸ¥ä¹</p>
<p>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<p>RetentionPolicy.SOURCEï¼šåªåœ¨æœ¬ç¼–è¯‘å•å…ƒçš„ç¼–è¯‘è¿‡ç¨‹ä¸­ä¿ç•™ï¼Œå¹¶ä¸å†™å…¥Classæ–‡ä»¶ä¸­ã€‚è¿™ç§æ³¨è§£ä¸»è¦ç”¨äºåœ¨æœ¬ç¼–è¯‘å•å…ƒï¼ˆè¿™é‡Œä¸€ä¸ªJavaæºç æ–‡ä»¶å¯ä»¥çœ‹ä½œä¸€ä¸ªç¼–è¯‘å•å…ƒï¼‰å†…è§¦å‘æ³¨è§£å¤„ç†å™¨ï¼ˆannotation processorï¼‰çš„ç›¸å…³å¤„ç†ï¼Œä¾‹å¦‚è¯´å¯ä»¥è®©æ³¨è§£å¤„ç†å™¨ç›¸åº”åœ°ç”Ÿæˆä¸€äº›ä»£ç ï¼Œæˆ–è€…æ˜¯è®©æ³¨è§£å¤„ç†å™¨åšä¸€äº›é¢å¤–çš„ç±»å‹æ£€æŸ¥(@Override)ï¼Œç­‰ç­‰ã€‚</p>
<p>RetentionPolicy.CLASSï¼šåœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ä¿ç•™å¹¶ä¸”ä¼šå†™å…¥Classæ–‡ä»¶ä¸­ï¼Œä½†æ˜¯JVMåœ¨åŠ è½½ç±»çš„æ—¶å€™ä¸éœ€è¦å°†å…¶åŠ è½½ä¸ºè¿è¡Œæ—¶å¯è§çš„ï¼ˆåå°„å¯è§ï¼‰çš„æ³¨è§£ã€‚è¿™é‡Œå¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ç¼–è¯‘å¤šä¸ªJavaæ–‡ä»¶æ—¶çš„æƒ…å†µï¼šå‡å¦‚è¦ç¼–è¯‘A.javaæºç æ–‡ä»¶å’ŒB.classæ–‡ä»¶ï¼Œå…¶ä¸­Aç±»ä¾èµ–Bç±»ï¼Œå¹¶ä¸”Bç±»ä¸Šæœ‰äº›æ³¨è§£å¸Œæœ›è®©A.javaç¼–è¯‘æ—¶èƒ½çœ‹åˆ°ï¼Œé‚£ä¹ˆB.classé‡Œå°±å¿…é¡»è¦æŒæœ‰è¿™äº›æ³¨è§£ä¿¡æ¯æ‰è¡Œã€‚</p>
<ul>
<li>åŒæ—¶æˆ‘ä»¬å¯èƒ½ä¸éœ€è¦è®©å®ƒåœ¨è¿è¡Œæ—¶å¯¹åå°„å¯è§ï¼ˆä¾‹å¦‚è¯´ä¸ºäº†å‡å°‘è¿è¡Œæ—¶å…ƒæ•°æ®çš„å¤§å°ä¹‹ç±»ï¼‰ï¼Œæ‰€ä»¥ä¼šé€‰æ‹©CLASSè€Œä¸æ˜¯RUNTIMEã€‚</li>
</ul>
<p>RetentionPolicy.RUNTIMEï¼šåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä¿ç•™ï¼Œä¼šå†™å…¥Classæ–‡ä»¶ï¼Œå¹¶ä¸”JVMåŠ è½½ç±»çš„æ—¶å€™ä¹Ÿä¼šå°†å…¶åŠ è½½ä¸ºåå°„å¯è§çš„æ³¨è§£ã€‚è¿™å°±ä¸ç”¨å¤šè¯´äº†ï¼Œä¾‹å¦‚è¯´Springçš„ä¾èµ–æ³¨å…¥å°±ä¼šåœ¨è¿è¡Œæ—¶é€šè¿‡æ‰«æç±»ä¸Šçš„æ³¨è§£æ¥å†³å®šæ³¨å…¥å•¥ã€‚</p>
</blockquote>
</li>
<li><p>@Document </p>
<p>æè¿°javadoc</p>
</li>
<li><p>@Inherited  </p>
<p>å¦‚æœå€¼æ˜¯æ˜¯çš„è¯ è¢«æ ‡æ³¨äº†è¿™ä¸ªæ³¨è§£çš„ç±»çš„å­ç±»ä¹Ÿä¼šæœ‰è¿™ä¸ªæ³¨è§£</p>
</li>
</ul>
<h1 id="Spring-åŸç†"><a href="#Spring-åŸç†" class="headerlink" title="Spring åŸç†"></a>Spring åŸç†</h1><h2 id="Spring-Bean-ç”Ÿå‘½å‘¨æœŸ"><a href="#Spring-Bean-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Spring Bean ç”Ÿå‘½å‘¨æœŸ"></a>Spring Bean ç”Ÿå‘½å‘¨æœŸ</h2><p><img src="http://img.andrewchen1.top/181453414212066.png" alt="ç”Ÿå‘½å‘¨æœŸ"></p>
<p><img src="http://img.andrewchen1.top/181454040628981.png" alt="ç”Ÿå‘½å‘¨æœŸ"></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zrtqsk/p/3735273.html">ç”Ÿå‘½å‘¨æœŸ</a></p>
<h2 id="Beançš„å®šä¹‰"><a href="#Beançš„å®šä¹‰" class="headerlink" title="Beançš„å®šä¹‰"></a>Beançš„å®šä¹‰</h2><p>å¯ä»¥é€šè¿‡åœ¨xmlä¸­å®šä¹‰Bean</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span> = <span class="string">&quot;&quot;</span> <span class="attr">class</span> = <span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password]&#125;&quot;</span></span></span><br><span class="line">  &lt;/bean&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…åœ¨ç±»ä¸Šé¢ä½¿ç”¨@Componentçš„æ³¨è§£ã€‚ é€šè¿‡ComponentScançš„æ–¹å¼è¦æ‰¾åˆ°ç›¸å…³çš„ç±»ã€‚æ’ä¸€å¥ ComponentScançš„æ€ä¹ˆåš</p>
<ul>
<li><p>ComponentScanAnnotationParser#parse</p>
</li>
<li><p>ClassPathBeanDefinitionScanner#doScan</p>
</li>
<li><p>ClassPathScanningCandidateComponentProvider#findCandidateComponents</p>
<p>â€‹    è¦åšçš„äº‹æƒ…å°±æ˜¯è¯»å–Classçš„æ–‡ä»¶æµï¼Œé€šè¿‡JVMä¸­classçš„å®šä¹‰è·å¾—å®ç°çš„æ¥å£ç­‰çš„ä¿¡æ¯ï¼Œç„¶åæŠŠè¿™äº›ä¿¡æ¯å†™å…¥åˆ°beandefinition å¯¹è±¡ä¸­ã€‚</p>
<ul>
<li><p>å°†class path ä¸­çš„.æ›¿æ¢æˆ/</p>
</li>
<li><p>æ‹¼è£…æˆ classpath<em>:ç»è¿‡è½¬æ¢çš„basePackageåœ°å€ +  **/\</em>.class</p>
</li>
<li><p>MetadataReaderFactory#getMetadataReader</p>
</li>
<li><p>SimpleMetadataReader#getMetadataReader</p>
</li>
<li><p>ClassReader#accept </p>
<p>è¿™é‡Œæ¶‰åŠåˆ°ASMçš„å†…å®¹<a target="_blank" rel="noopener" href="http://img.andrewchen1.top/ASM4%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.pdf">ASM4ä½¿ç”¨æŒ‡å—</a> æ ¹æ®è§„èŒƒç¼–è¯‘åçš„classæ–‡ä»¶çš„æ ¼å¼æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ASMå·¥å…·æ¥ä»classæ–‡ä»¶ä¸­è¯»å–æˆ‘ä»¬å…³å¿ƒçš„ä¿¡æ¯ã€‚</p>
</li>
</ul>
<p>è¿”å›å«æœ‰çˆ¶ç±»ã€å®ç°æ¥å£ã€æ³¨è§£ç­‰ä¿¡æ¯çš„åŒ…è£…ç±»(RootBeanDefination)</p>
</li>
</ul>
<h2 id="ä»DefaultListableBeanFactory-ç®¡ä¸­çª¥è±¹-çœ‹Beançš„ç”Ÿå‘½æµç¨‹"><a href="#ä»DefaultListableBeanFactory-ç®¡ä¸­çª¥è±¹-çœ‹Beançš„ç”Ÿå‘½æµç¨‹" class="headerlink" title="ä»DefaultListableBeanFactory ç®¡ä¸­çª¥è±¹ çœ‹Beançš„ç”Ÿå‘½æµç¨‹"></a>ä»DefaultListableBeanFactory ç®¡ä¸­çª¥è±¹ çœ‹Beançš„ç”Ÿå‘½æµç¨‹</h2><p>å› ä¸ºBeanFactoryæ˜¯æ‡’åŠ è½½çš„ ï¼Œå½“æˆ‘ä»¬è°ƒç”¨getBean()çš„æ—¶å€™ï¼Œä¼š</p>
<ul>
<li><p>AbstractBeanFactory#doGetBean(inal String name, final Class<T> requiredType, final Object[] args, boolean typeCheckOnly)</p>
<ul>
<li><p>transformedBeanName</p>
<p>å¾—åˆ°bean Nameï¼Œå…¥å‚çš„beanNameä¸­å¦‚æœæœ‰&amp;ç¬¦å· æˆªå–åˆ°æœ€åä¸€ä¸ª&amp;å¼€å§‹åˆ°ç»“æŸçš„å­å­—ç¬¦ä¸²ä½œä¸ºbean name</p>
</li>
<li><p>DefaultSingletonBeanRegistry#getSingleton</p>
<h4 id="èƒŒæ™¯çŸ¥è¯†-Beançš„å¾ªç¯ä¾èµ–å’Œè§£å†³"><a href="#èƒŒæ™¯çŸ¥è¯†-Beançš„å¾ªç¯ä¾èµ–å’Œè§£å†³" class="headerlink" title="èƒŒæ™¯çŸ¥è¯† Beançš„å¾ªç¯ä¾èµ–å’Œè§£å†³"></a>èƒŒæ™¯çŸ¥è¯† Beançš„å¾ªç¯ä¾èµ–å’Œè§£å†³</h4><p>ä»¥ä¸‹å†…å®¹æ¥è‡ª <a target="_blank" rel="noopener" href="https://blog.csdn.net/u010853261/article/details/77940767">Spring-beançš„å¾ªç¯ä¾èµ–ä»¥åŠè§£å†³æ–¹å¼</a></p>
<p> Springçš„å•ä¾‹å¯¹è±¡çš„åˆå§‹åŒ–ä¸»è¦åˆ†ä¸ºä¸‰æ­¥ï¼š</p>
<ul>
<li><p>create Bean Instance å®ä¾‹åŒ–</p>
</li>
<li><p>popluate Bean å¡«å……å±æ€§</p>
</li>
<li><p>Initalize Bean åˆå§‹åŒ–</p>
<p>åœ¨Springå®¹å™¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“æƒ³åˆ°è¿™ä¸ªå¯¹è±¡åº”è¯¥å­˜åœ¨Cacheä¸­ï¼ŒSpringä¸ºäº†è§£å†³å•ä¾‹çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½¿ç”¨äº†<strong>ä¸‰çº§ç¼“å­˜</strong>ã€‚</p>
<p>DefaultSingletonBeanRegistry.class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Cache of singleton objects: bean name --&gt; bean instance */</span></span><br><span class="line"><span class="comment">// å•ä¾‹å¯¹è±¡çš„cache</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> ConcurrentHashMap&lt;String, Object&gt;(<span class="number">256</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Cache of singleton factories: bean name --&gt; ObjectFactory */</span></span><br><span class="line"><span class="comment">// å•ä¾‹å·¥å‚çš„cache </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span class="keyword">new</span> HashMap&lt;String, ObjectFactory&lt;?&gt;&gt;(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Cache of early singleton objects: bean name --&gt; bean instance */</span></span><br><span class="line"><span class="comment">// æå‰æ›å…‰çš„å•ä¾‹å¯¹è±¡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; earlySingletonObjects = <span class="keyword">new</span> HashMap&lt;String, Object&gt;(<span class="number">16</span>);</span><br></pre></td></tr></table></figure>

<p>å°è¯•ä»cacheä¸­è·å¾—å¯¹è±¡</p>
<p>DefaultSingletonBeanRegistry#getSingleton</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">getSingleton</span><span class="params">(String beanName, <span class="keyword">boolean</span> allowEarlyReference)</span> </span>&#123;</span><br><span class="line">    Object singletonObject = <span class="keyword">this</span>.singletonObjects.get(beanName);</span><br><span class="line">    <span class="keyword">if</span> (singletonObject == <span class="keyword">null</span> &amp;&amp; isSingletonCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>.singletonObjects) &#123;</span><br><span class="line">            singletonObject = <span class="keyword">this</span>.earlySingletonObjects.get(beanName);</span><br><span class="line">            <span class="keyword">if</span> (singletonObject == <span class="keyword">null</span> &amp;&amp; allowEarlyReference) &#123;</span><br><span class="line">                ObjectFactory&lt;?&gt; singletonFactory = <span class="keyword">this</span>.singletonFactories.get(beanName);</span><br><span class="line">                <span class="keyword">if</span> (singletonFactory != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    singletonObject = singletonFactory.getObject();</span><br><span class="line">                    <span class="keyword">this</span>.earlySingletonObjects.put(beanName, singletonObject);</span><br><span class="line">                    <span class="keyword">this</span>.singletonFactories.remove(beanName);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (singletonObject != NULL_OBJECT ? singletonObject : <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç éœ€è¦è§£é‡Šä¸¤ä¸ªå‚æ•°ï¼š</p>
<p>isSingletonCurrentlyInCreation()åˆ¤æ–­å½“å‰å•ä¾‹beanæ˜¯å¦æ­£åœ¨åˆ›å»ºä¸­ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰åˆå§‹åŒ–å®Œæˆ(æ¯”å¦‚Açš„æ„é€ å™¨ä¾èµ–äº†Bå¯¹è±¡æ‰€ä»¥å¾—å…ˆå»åˆ›å»ºBå¯¹è±¡ï¼Œ æˆ–åˆ™åœ¨Açš„populateBeanè¿‡ç¨‹ä¸­ä¾èµ–äº†Bå¯¹è±¡ï¼Œå¾—å…ˆå»åˆ›å»ºBå¯¹è±¡ï¼Œè¿™æ—¶çš„Aå°±æ˜¯å¤„äºåˆ›å»ºä¸­çš„çŠ¶æ€ã€‚)<br>allowEarlyReference æ˜¯å¦å…è®¸ä»singletonFactoriesä¸­é€šè¿‡getObjectæ‹¿åˆ°å¯¹è±¡<br>åˆ†ægetSingleton()çš„æ•´ä¸ªè¿‡ç¨‹ï¼ŒSpringé¦–å…ˆä»ä¸€çº§ç¼“å­˜singletonObjectsä¸­è·å–ã€‚å¦‚æœè·å–ä¸åˆ°ï¼Œå¹¶ä¸”å¯¹è±¡æ­£åœ¨åˆ›å»ºä¸­ï¼Œå°±å†ä»äºŒçº§ç¼“å­˜earlySingletonObjectsä¸­è·å–ã€‚å¦‚æœè¿˜æ˜¯è·å–ä¸åˆ°ä¸”å…è®¸singletonFactoriesé€šè¿‡getObject()è·å–ï¼Œå°±ä»ä¸‰çº§ç¼“å­˜singletonFactory.getObject()(ä¸‰çº§ç¼“å­˜)è·å–ï¼Œå¦‚æœè·å–åˆ°äº†åˆ™ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.earlySingletonObjects.put(beanName, singletonObject);</span><br><span class="line"><span class="keyword">this</span>.singletonFactories.remove(beanName);</span><br></pre></td></tr></table></figure>


</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code> ä»singletonFactoriesä¸­ç§»é™¤ï¼Œå¹¶æ”¾å…¥earlySingletonObjectsä¸­ã€‚å…¶å®ä¹Ÿå°±æ˜¯ä»ä¸‰çº§ç¼“å­˜ç§»åŠ¨åˆ°äº†äºŒçº§ç¼“å­˜ã€‚

 ä»ä¸Šé¢ä¸‰çº§ç¼“å­˜çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒSpringè§£å†³å¾ªç¯ä¾èµ–çš„è¯€çªå°±åœ¨äºsingletonFactoriesè¿™ä¸ªä¸‰çº§cacheã€‚è¿™ä¸ªcacheçš„ç±»å‹æ˜¯ObjectFactoryï¼Œå®šä¹‰å¦‚ä¸‹ï¼š

 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ObjectFactory</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


 è¿™ä¸ªæ¥å£åœ¨ä¸‹é¢è¢«å¼•ç”¨

 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addSingletonFactory</span><span class="params">(String beanName, ObjectFactory&lt;?&gt; singletonFactory)</span> </span>&#123;</span><br><span class="line">    Assert.notNull(singletonFactory, <span class="string">&quot;Singleton factory must not be null&quot;</span>);</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>.singletonObjects) &#123;</span><br><span class="line">        <span class="keyword">if</span> (! <span class="keyword">this</span>.singletonObjects.containsKey(beanName)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.singletonFactories.put(beanName, singletonFactory);</span><br><span class="line">            <span class="keyword">this</span>.earlySingletonObjects.remove(beanName);</span><br><span class="line">            <span class="keyword">this</span>.registeredSingletons.add(beanName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 è¿™é‡Œå°±æ˜¯è§£å†³å¾ªç¯ä¾èµ–çš„å…³é”®ï¼Œè¿™æ®µä»£ç å‘ç”Ÿåœ¨createBeanInstanceä¹‹åï¼Œä¹Ÿå°±æ˜¯è¯´å•ä¾‹å¯¹è±¡æ­¤æ—¶å·²ç»è¢«åˆ›å»ºå‡ºæ¥(è°ƒç”¨äº†æ„é€ å™¨)ã€‚è¿™ä¸ªå¯¹è±¡å·²ç»è¢«ç”Ÿäº§å‡ºæ¥äº†ï¼Œè™½ç„¶è¿˜ä¸å®Œç¾ï¼ˆè¿˜æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–çš„ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥ï¼‰ï¼Œä½†æ˜¯å·²ç»èƒ½è¢«äººè®¤å‡ºæ¥äº†ï¼ˆæ ¹æ®å¯¹è±¡å¼•ç”¨èƒ½å®šä½åˆ°å †ä¸­çš„å¯¹è±¡ï¼‰ï¼Œæ‰€ä»¥Springæ­¤æ—¶å°†è¿™ä¸ªå¯¹è±¡æå‰æ›å…‰å‡ºæ¥è®©å¤§å®¶è®¤è¯†ï¼Œè®©å¤§å®¶ä½¿ç”¨ã€‚



 è¿™æ ·åšæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿè®©æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹â€œAçš„æŸä¸ªfieldæˆ–è€…setterä¾èµ–äº†Bçš„å®ä¾‹å¯¹è±¡ï¼ŒåŒæ—¶Bçš„æŸä¸ªfieldæˆ–è€…setterä¾èµ–äº†Açš„å®ä¾‹å¯¹è±¡â€è¿™ç§å¾ªç¯ä¾èµ–çš„æƒ…å†µã€‚Aé¦–å…ˆå®Œæˆäº†åˆå§‹åŒ–çš„ç¬¬ä¸€æ­¥ï¼Œå¹¶ä¸”å°†è‡ªå·±æå‰æ›å…‰åˆ°singletonFactoriesä¸­ï¼Œæ­¤æ—¶è¿›è¡Œåˆå§‹åŒ–çš„ç¬¬äºŒæ­¥ï¼Œå‘ç°è‡ªå·±ä¾èµ–å¯¹è±¡Bï¼Œæ­¤æ—¶å°±å°è¯•å»get(B)ï¼Œå‘ç°Bè¿˜æ²¡æœ‰è¢«createï¼Œæ‰€ä»¥èµ°createæµç¨‹ï¼ŒBåœ¨åˆå§‹åŒ–ç¬¬ä¸€æ­¥çš„æ—¶å€™å‘ç°è‡ªå·±ä¾èµ–äº†å¯¹è±¡Aï¼Œäºæ˜¯å°è¯•get(A)ï¼Œå°è¯•ä¸€çº§ç¼“å­˜singletonObjects(è‚¯å®šæ²¡æœ‰ï¼Œå› ä¸ºAè¿˜æ²¡åˆå§‹åŒ–å®Œå…¨)ï¼Œå°è¯•äºŒçº§ç¼“å­˜earlySingletonObjectsï¼ˆä¹Ÿæ²¡æœ‰ï¼‰ï¼Œå°è¯•ä¸‰çº§ç¼“å­˜singletonFactoriesï¼Œç”±äºAé€šè¿‡ObjectFactoryå°†è‡ªå·±æå‰æ›å…‰äº†ï¼Œæ‰€ä»¥Bèƒ½å¤Ÿé€šè¿‡ObjectFactory.getObjectæ‹¿åˆ°Aå¯¹è±¡(è™½ç„¶Aè¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œå…¨ï¼Œä½†æ˜¯æ€»æ¯”æ²¡æœ‰å¥½å‘€)ï¼ŒBæ‹¿åˆ°Aå¯¹è±¡åé¡ºåˆ©å®Œæˆäº†åˆå§‹åŒ–é˜¶æ®µ1ã€2ã€3ï¼Œå®Œå…¨åˆå§‹åŒ–ä¹‹åå°†è‡ªå·±æ”¾å…¥åˆ°ä¸€çº§ç¼“å­˜singletonObjectsä¸­ã€‚æ­¤æ—¶è¿”å›Aä¸­ï¼ŒAæ­¤æ—¶èƒ½æ‹¿åˆ°Bçš„å¯¹è±¡é¡ºåˆ©å®Œæˆè‡ªå·±çš„åˆå§‹åŒ–é˜¶æ®µ2ã€3ï¼Œæœ€ç»ˆAä¹Ÿå®Œæˆäº†åˆå§‹åŒ–ï¼Œè¿›å»äº†ä¸€çº§ç¼“å­˜singletonObjectsä¸­ï¼Œè€Œä¸”æ›´åŠ å¹¸è¿çš„æ˜¯ï¼Œç”±äºBæ‹¿åˆ°äº†Açš„å¯¹è±¡å¼•ç”¨ï¼Œæ‰€ä»¥Bç°åœ¨holdä½çš„Aå¯¹è±¡å®Œæˆäº†åˆå§‹åŒ–ã€‚

 çŸ¥é“äº†è¿™ä¸ªåŸç†æ—¶å€™ï¼Œè‚¯å®šå°±çŸ¥é“ä¸ºå•¥Springä¸èƒ½è§£å†³â€œAçš„æ„é€ æ–¹æ³•ä¸­ä¾èµ–äº†Bçš„å®ä¾‹å¯¹è±¡ï¼ŒåŒæ—¶Bçš„æ„é€ æ–¹æ³•ä¸­ä¾èµ–äº†Açš„å®ä¾‹å¯¹è±¡â€è¿™ç±»é—®é¢˜äº†ï¼å› ä¸ºåŠ å…¥singletonFactoriesä¸‰çº§ç¼“å­˜çš„å‰ææ˜¯æ‰§è¡Œäº†æ„é€ å™¨ï¼Œæ‰€ä»¥æ„é€ å™¨çš„å¾ªç¯ä¾èµ–æ²¡æ³•è§£å†³ã€‚

 å‚è€ƒ http://www.jianshu.com/p/6c359768b1dc

å¦‚æœåœ¨ä¸‰çº§ç¼“å­˜ä¸­æ‰¾åˆ°äº† å†é€šè¿‡BeanNameåšä¸€æ¬¡åˆ¤æ–­ åˆ¤æ–­è¿™ä¸ª æˆ‘ä»¬æƒ³è¦çš„æ˜¯è¿™ä¸ªbean è¿˜æ˜¯ç”Ÿæˆè¿™ä¸ªbeançš„factoryã€‚ åœ¨æœ€åˆçš„æ—¶å€™æˆ‘ä»¬æ˜¯æŠŠbean name ç»™å¤„ç†äº†ä¸€æ¬¡çš„ çœ‹ä¸Šé¢çš„**transformedBeanName** è¯´æ˜ã€‚</code></pre><ul>
<li><p>getObjectForBeanInstance</p>
<p>åœ¨ä¹‹å‰æˆ‘ä»¬åœ¨cacheä¸­æ‰¾åˆ°äº†beanã€‚ä½†æ˜¯è¿™ä¸ªbeanå¯èƒ½æ˜¯factoryBeanã€‚ æˆ‘ä»¬éœ€è¦é€šè¿‡å·¥å‚Bean è·å¾—äº§å“Bean</p>
<p>AbstractBeanFactory#getObjectForBeanInstance</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">getObjectForBeanInstance</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			Object beanInstance, String name, String beanName, RootBeanDefinition mbd)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Don&#x27;t let calling code try to dereference the factory if the bean isn&#x27;t a factory.</span></span><br><span class="line">  <span class="comment">// å› ä¸ºåœ¨å°è¯•è·å¾—beançš„ä½¿ç”¨beançš„åå­—æ˜¯å»æ‰&amp;ç¬¦å·çš„ã€‚&amp;è¡¨ç¤ºå·¥å‚beanã€‚ ä½†æ˜¯æ ¹æ®è¿™ä¸ªbeanNameè·å–é“çš„å¹¶ä¸æ˜¯FactoryBeançš„ æŠ›é”™</span></span><br><span class="line">		<span class="keyword">if</span> (BeanFactoryUtils.isFactoryDereference(name) &amp;&amp; !(beanInstance <span class="keyword">instanceof</span> FactoryBean)) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> BeanIsNotAFactoryException(transformedBeanName(name), beanInstance.getClass());</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Now we have the bean instance, which may be a normal bean or a FactoryBean.</span></span><br><span class="line">		<span class="comment">// If it&#x27;s a FactoryBean, we use it to create a bean instance, unless the</span></span><br><span class="line">		<span class="comment">// caller actually wants a reference to the factory.</span></span><br><span class="line">  <span class="comment">// ç›¸å½“äº ! beanInstance instanceof FactoryBean &amp;&amp; ! BeanFactoryUtils.isFactoryDereference(name) ç¡®å®š åå­—å¹¶ä¸æ˜¯BeanFactoryç±»å‹çš„ ä¸” å¾—åˆ°çš„ç±»å¹¶ä¸æ˜¯å·¥å‚ç±»å‹çš„ï¼Œ return bean</span></span><br><span class="line">		<span class="keyword">if</span> (!(beanInstance <span class="keyword">instanceof</span> FactoryBean) || BeanFactoryUtils.isFactoryDereference(name)) &#123;</span><br><span class="line">			<span class="keyword">return</span> beanInstance;</span><br><span class="line">		&#125;</span><br><span class="line"><span class="comment">// å¦åˆ™å°±æ˜¯é€šè¿‡BeanFactoryæ„å»ºBean</span></span><br><span class="line">		Object object = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">if</span> (mbd == <span class="keyword">null</span>) &#123;</span><br><span class="line">			object = getCachedObjectForFactoryBean(beanName);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (object == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="comment">// Return bean instance from factory.</span></span><br><span class="line">			FactoryBean&lt;?&gt; factory = (FactoryBean&lt;?&gt;) beanInstance;</span><br><span class="line">			<span class="comment">// Caches object obtained from FactoryBean if it is a singleton.</span></span><br><span class="line">			<span class="keyword">if</span> (mbd == <span class="keyword">null</span> &amp;&amp; containsBeanDefinition(beanName)) &#123;</span><br><span class="line">				mbd = getMergedLocalBeanDefinition(beanName);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">boolean</span> synthetic = (mbd != <span class="keyword">null</span> &amp;&amp; mbd.isSynthetic());</span><br><span class="line">			object = getObjectFromFactoryBean(factory, beanName, !synthetic);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> object;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡getObjectFromFactoryBeanè·å¾—Beanï¼Œåœ¨factoryBeanObjectCacheä¸­æ˜¯ä¸æ˜¯å·²ç»å­˜åœ¨Beanäº†ï¼Œå¦‚æœå­˜åœ¨ç›´æ¥è¿”å›ï¼Œ å¦‚æœæ²¡æœ‰ é€šè¿‡BeanFactory æ„å»ºï¼Œæ„å»ºçš„Beanè¿˜æ˜¯è¦AbstractAutowireCapableBeanFactory#applyBeanPostProcessorsAfterInitialization è¿›è¡Œç»„è£…ã€‚ åŒæ—¶æ ¹æ®factory bean æ˜¯å¦æ˜¯isSingletonçš„æ¥ç¡®å®šæ˜¯å¦è¦åŠ å…¥åˆ°factoryBeanObjectCacheä¸­</p>
<p>FactoryBeanRegistrySupport#getObjectFromFactoryBean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Obtain an object to expose from the given FactoryBean.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> factory the FactoryBean instance</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> beanName the name of the bean</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> shouldPostProcess whether the bean is subject to post-processing</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the object obtained from the FactoryBean</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> BeanCreationException if FactoryBean object creation failed</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> org.springframework.beans.factory.FactoryBean#getObject()</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> Object <span class="title">getObjectFromFactoryBean</span><span class="params">(FactoryBean&lt;?&gt; factory, String beanName, <span class="keyword">boolean</span> shouldPostProcess)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (factory.isSingleton() &amp;&amp; containsSingleton(beanName)) &#123;</span><br><span class="line">			<span class="keyword">synchronized</span> (getSingletonMutex()) &#123;</span><br><span class="line">				Object object = <span class="keyword">this</span>.factoryBeanObjectCache.get(beanName);</span><br><span class="line">				<span class="keyword">if</span> (object == <span class="keyword">null</span>) &#123;</span><br><span class="line">					object = doGetObjectFromFactoryBean(factory, beanName);</span><br><span class="line">					<span class="comment">// Only post-process and store if not put there already during getObject() call above</span></span><br><span class="line">					<span class="comment">// (e.g. because of circular reference processing triggered by custom getBean calls)</span></span><br><span class="line">					Object alreadyThere = <span class="keyword">this</span>.factoryBeanObjectCache.get(beanName);</span><br><span class="line">					<span class="keyword">if</span> (alreadyThere != <span class="keyword">null</span>) &#123;</span><br><span class="line">						object = alreadyThere;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">else</span> &#123;</span><br><span class="line">						<span class="keyword">if</span> (object != <span class="keyword">null</span> &amp;&amp; shouldPostProcess) &#123;</span><br><span class="line">							<span class="keyword">if</span> (isSingletonCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">								<span class="comment">// Temporarily return non-post-processed object, not storing it yet..</span></span><br><span class="line">								<span class="keyword">return</span> object;</span><br><span class="line">							&#125;</span><br><span class="line">							beforeSingletonCreation(beanName);</span><br><span class="line">							<span class="keyword">try</span> &#123;</span><br><span class="line">								object = postProcessObjectFromFactoryBean(object, beanName);</span><br><span class="line">							&#125;</span><br><span class="line">							<span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">								<span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(beanName,</span><br><span class="line">										<span class="string">&quot;Post-processing of FactoryBean&#x27;s singleton object failed&quot;</span>, ex);</span><br><span class="line">							&#125;</span><br><span class="line">							<span class="keyword">finally</span> &#123;</span><br><span class="line">								afterSingletonCreation(beanName);</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">if</span> (containsSingleton(beanName)) &#123;</span><br><span class="line">							<span class="keyword">this</span>.factoryBeanObjectCache.put(beanName, (object != <span class="keyword">null</span> ? object : NULL_OBJECT));</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> (object != NULL_OBJECT ? object : <span class="keyword">null</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			Object object = doGetObjectFromFactoryBean(factory, beanName);</span><br><span class="line">			<span class="keyword">if</span> (object != <span class="keyword">null</span> &amp;&amp; shouldPostProcess) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					object = postProcessObjectFromFactoryBean(object, beanName);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(beanName, <span class="string">&quot;Post-processing of FactoryBean&#x27;s object failed&quot;</span>, ex);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> object;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœè¿™ä¸ªBeanåœ¨è¿™ä¹‹å‰æ²¡æœ‰åˆ›å»ºè¿‡ï¼Œé‚£ä¹ˆè¦è¿›è¡Œåˆ›å»ºã€‚</p>
<ul>
<li><p>å¦‚æœè¿™ä¸ªBeanfactroyæœ‰parent Bean factoryçš„è¯ã€‚ é‚£ä¹ˆé€šè¿‡å§”æ‰˜çš„æ–¹å¼çœ‹èƒ½ä¸èƒ½å¾—åˆ°bean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Check if bean definition exists in this factory.</span></span><br><span class="line">			BeanFactory parentBeanFactory = getParentBeanFactory();</span><br><span class="line">			<span class="keyword">if</span> (parentBeanFactory != <span class="keyword">null</span> &amp;&amp; !containsBeanDefinition(beanName)) &#123;</span><br><span class="line">				<span class="comment">// Not found -&gt; check parent.</span></span><br><span class="line">				String nameToLookup = originalBeanName(name);</span><br><span class="line">				<span class="keyword">if</span> (args != <span class="keyword">null</span>) &#123;</span><br><span class="line">					<span class="comment">// Delegation to parent with explicit args.</span></span><br><span class="line">					<span class="keyword">return</span> (T) parentBeanFactory.getBean(nameToLookup, args);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="comment">// No args -&gt; delegate to standard getBean method.</span></span><br><span class="line">					<span class="keyword">return</span> parentBeanFactory.getBean(nameToLookup, requiredType);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä¿è¯åˆ›å»ºè¿™ä¸ªbeançš„æ—¶å€™ï¼Œå®ƒæ„é€ æ–¹æ³•ä¸­çš„Beanéƒ½å·²ç»åˆ›å»ºå¥½äº†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">String[] dependsOn = mbd.getDependsOn();</span><br><span class="line">				<span class="keyword">if</span> (dependsOn != <span class="keyword">null</span>) &#123;</span><br><span class="line">					<span class="keyword">for</span> (String dep : dependsOn) &#123;</span><br><span class="line">						<span class="keyword">if</span> (isDependent(beanName, dep)) &#123;</span><br><span class="line">							<span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(mbd.getResourceDescription(), beanName,</span><br><span class="line">									<span class="string">&quot;Circular depends-on relationship between &#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27; and &#x27;&quot;</span> + dep + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">						&#125;</span><br><span class="line">						registerDependentBean(dep, beanName);</span><br><span class="line">						<span class="keyword">try</span> &#123;</span><br><span class="line">							getBean(dep);</span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">catch</span> (NoSuchBeanDefinitionException ex) &#123;</span><br><span class="line">							<span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(mbd.getResourceDescription(), beanName,</span><br><span class="line">									<span class="string">&quot;&#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27; depends on missing bean &#x27;&quot;</span> + dep + <span class="string">&quot;&#x27;&quot;</span>, ex);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>DefaultSingletonBeanRegistry#isDependent</p>
<p>é€šè¿‡é€’å½’çš„æ–¹å¼è¿›è¡Œè°ƒç”¨ ä¿è¯è¿™ä¸ªBean æ„é€ æ–¹æ³•ä¸­æ‰€ä¾èµ–çš„Beanï¼ŒBean æ„é€ æ–¹æ³•ä¸­æ‰€ä¾èµ–çš„Beançš„æ„é€ æ–¹æ³•ä¸­ï¼ˆå¦‚æœè¿™ä¸ªBeanè¿˜æ²¡æœ‰è¢«åˆ›å»ºçš„è¯ï¼‰æ‰€ä¾èµ–çš„Beanâ€¦ éƒ½å·²ç»å‡†å¤‡å¥½äº†ï¼Œå¦åˆ™æŠ¥é”™ğŸ’¥</p>
<p>*<em>è¿™é‡Œå°±æ˜¾ç¤ºäº†é€šè¿‡æ„é€ æ–¹æ³•ï¼Œä¾èµ–æ³¨å…¥çš„æ–¹å¼åˆ›å»ºBeanï¼ŒBeanä¹‹é—´ä¸å…è®¸äº’ç›¸ä¾èµ–ï¼Œä½†æ˜¯é€šè¿‡setterçš„æ–¹å¼ï¼Œä¾èµ–æ³¨å…¥Beanï¼Œ Beanä¹‹é—´æ˜¯å…è®¸ *</em></p>
<p>ç‰¹åˆ«è¯´æ˜</p>
<p><strong>ä¸¾ä¸ªç®€å•ä¾‹å­ï¼šä¾‹å¦‚ B ä¾èµ–äº† Aï¼Œåˆ™ dependentBeanMap ç¼“å­˜ä¸­åº”è¯¥å­˜æ”¾ä¸€å¯¹æ˜ å°„ï¼šå…¶ä¸­ key ä¸º Aï¼Œvalue ä¸ºå«æœ‰ B çš„ Setï¼›è€Œ dependenciesForBeanMap ç¼“å­˜ä¸­ä¹Ÿåº”è¯¥å­˜æ”¾ä¸€å¯¹æ˜ å°„ï¼šå…¶ä¸­ key ä¸ºï¼šBï¼Œvalue ä¸ºå«æœ‰ A çš„ Setã€‚</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">      <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isDependent</span><span class="params">(String beanName, String dependentBeanName, Set&lt;String&gt; alreadySeen)</span> </span>&#123;</span><br><span class="line">      		<span class="keyword">if</span> (alreadySeen != <span class="keyword">null</span> &amp;&amp; alreadySeen.contains(beanName)) &#123;</span><br><span class="line">      			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      		&#125;</span><br><span class="line">      		String canonicalName = canonicalName(beanName);</span><br><span class="line">      		Set&lt;String&gt; dependentBeans = <span class="keyword">this</span>.dependentBeanMap.get(canonicalName);</span><br><span class="line">      		<span class="keyword">if</span> (dependentBeans == <span class="keyword">null</span>) &#123;</span><br><span class="line">      			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      		&#125;</span><br><span class="line">      		<span class="keyword">if</span> (dependentBeans.contains(dependentBeanName)) &#123;</span><br><span class="line">      			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      		&#125;</span><br><span class="line">      		<span class="keyword">for</span> (String transitiveDependency : dependentBeans) &#123;</span><br><span class="line">      			<span class="keyword">if</span> (alreadySeen == <span class="keyword">null</span>) &#123;</span><br><span class="line">      				alreadySeen = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">      			&#125;</span><br><span class="line">      			alreadySeen.add(beanName);</span><br><span class="line">      			<span class="keyword">if</span> (isDependent(transitiveDependency, dependentBeanName, alreadySeen)) &#123;</span><br><span class="line">      				<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      			&#125;</span><br><span class="line">&#125;</span><br><span class="line">      		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      	&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol start="2">
<li><p>BeanFactoryPostProcessor</p>
<p>å°†${}ä¸­çš„å€¼åšæ›¿æ¢æˆ*.propertiesä¸­çš„å†…å®¹</p>
</li>
<li><p>InstantiationAwareBeanPostProcessor#postProcessBeforInstantiation </p>
<p>Instantiation [ÉªnstÃ¦nÊƒÉªâ€™eÉªÊƒÉ™n] </p>
<p>æ‰§è¡ŒBeançš„æ„é€ å™¨</p>
</li>
<li><p>InstantiationAwareBeanPostProcessor#postProcessPropertyValue</p>
<p>æ ¹æ®xmlä¸­çš„å®šä¹‰è®¾ç½®propertyçš„å€¼</p>
</li>
<li><p>ApplicationContextAwareProcessor#postProcessBeforeInitialization</p>
<p>ApplicationContextAwareProcessoræ˜¯BeanPostProcessorçš„ä¸€ä¸ªå®ç° åœ¨å†…éƒ¨ä¼šè°ƒç”¨invokeAwareInterfacesæ–¹æ³• é‡Œé¢ä¼šæœ‰å¾ˆå¤šçš„if æ¥åˆ¤æ–­è¿™ä¸ªç±»æ˜¯ä¸æ˜¯ç‰¹å®šçš„awareç±»å‹ï¼Œæ¯”æ–¹è¯´</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (object <span class="keyword">instanceof</span> ApplicationContextAware) &#123;</span><br><span class="line">  ((ApplicationContextAware) object).setApplicationContext();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.andrewchen1.top/2019/08/11/Java-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%863/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="å°å¤«">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¤«çš„ç¬”è®°">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/11/Java-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%863/" class="post-title-link" itemprop="url">Java åŸºç¡€çŸ¥è¯†ç‚¹æ•´ç†3</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-11 16:21:13" itemprop="dateCreated datePublished" datetime="2019-08-11T16:21:13+08:00">2019-08-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-30 22:05:00" itemprop="dateModified" datetime="2020-08-30T22:05:00+08:00">2020-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">JavaåŸºç¡€çŸ¥è¯†</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Java-å¤šçº¿ç¨‹å¹¶å‘"><a href="#Java-å¤šçº¿ç¨‹å¹¶å‘" class="headerlink" title="Java å¤šçº¿ç¨‹å¹¶å‘"></a>Java å¤šçº¿ç¨‹å¹¶å‘</h1><h2 id="çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼"><a href="#çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼" class="headerlink" title="çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼"></a>çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼</h2><ol>
<li><p>ç»§æ‰¿Threadç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Thread thread = <span class="keyword">new</span> Thread() &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> 	</span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>å®ç°Runnableæ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Runnable run = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//do something</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">Thread t = <span class="keyword">new</span> Thread(run);</span><br></pre></td></tr></table></figure>
</li>
<li><p>ExecutorService Callable<E>, Future</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ExecutorSrevice threadPool = Executors.cachedThreadPool();</span><br><span class="line">Future f = threadPool.submit(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">  <span class="comment">// å„ç§runä»»åŠ¡çš„æè¿°</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h2><ol>
<li><p>newCachedThreadPool</p>
<p>è°ƒç”¨executeå°†é‡ç”¨ä¹‹å‰æ„é€ çš„çº¿ç¨‹(å¦‚æœçº¿ç¨‹å¯ç”¨) å¦‚æœç°æœ‰çš„çº¿ç¨‹æ²¡æœ‰å¯ç”¨çš„,åˆ™åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹å¹¶æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­.<strong>ç»ˆæ­¢å¹¶ä»ç¼“å­˜ä¸­ç§»é™¤</strong>é‚£äº›å·²æœ‰60sæœªè¢«ä½¿ç”¨çš„çº¿ç¨‹</p>
</li>
<li><p>newFixedThreadPool</p>
</li>
<li><p>newScheduledThreadPool</p>
</li>
<li><p>newSingleThreadExecutor</p>
</li>
</ol>
<h3 id="çº¿ç¨‹çš„ç»“æŸ"><a href="#çº¿ç¨‹çš„ç»“æŸ" class="headerlink" title="çº¿ç¨‹çš„ç»“æŸ"></a>çº¿ç¨‹çš„ç»“æŸ</h3><h4 id="å®šä¹‰ä¸€ä¸ªé€€å‡ºæ ‡å¿—"><a href="#å®šä¹‰ä¸€ä¸ªé€€å‡ºæ ‡å¿—" class="headerlink" title="å®šä¹‰ä¸€ä¸ªé€€å‡ºæ ‡å¿—"></a>å®šä¹‰ä¸€ä¸ªé€€å‡ºæ ‡å¿—</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Thread t = <span class="keyword">new</span> Thread() &#123;</span><br><span class="line">  <span class="keyword">volatile</span> Boolean stop;</span><br><span class="line">  </span><br><span class="line">  &#123;</span><br><span class="line">    stop = <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (! stop) &#123;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<h4 id="interrupted"><a href="#interrupted" class="headerlink" title="interrupted"></a>interrupted</h4><p>   ç”¨interrupted æœ‰ä¸¤ç§æ–¹æ³•</p>
<ol>
<li><p>å½“çº¿ç¨‹å¤„äºblockedçš„çŠ¶æ€çš„æ—¶å€™.æˆ‘ä»¬è°ƒç”¨è¯¥çº¿ç¨‹çš„interrupt()æ–¹æ³•ä¼šæŠ›å‡ºInterruptedException</p>
</li>
<li><p>åœ¨çº¿ç¨‹åœ¨å¤„äºéblockedçŠ¶æ€çš„æ—¶å€™ å»åˆ¤æ–­å®ƒçš„ä¸­æ–­æ ‡ç¤º,è¿™ä¸ªæ–¹æ³•ä¼šå’Œæ–¹æ³•1åŒæ—¶ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Thread t = <span class="keyword">new</span> Thread() &#123;</span><br><span class="line">  <span class="keyword">volatile</span> Boolean stop;</span><br><span class="line">  </span><br><span class="line">  &#123;</span><br><span class="line">    stop = <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (! stop &amp;&amp; ! isInterrupted()) &#123;</span><br><span class="line">      <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="sleep-å’Œwaitä¹‹é—´çš„åŒºåˆ«"><a href="#sleep-å’Œwaitä¹‹é—´çš„åŒºåˆ«" class="headerlink" title="sleep å’Œwaitä¹‹é—´çš„åŒºåˆ«"></a>sleep å’Œwaitä¹‹é—´çš„åŒºåˆ«</h4><p>â€‹        - sleep æ˜¯å±äºThread çš„æ–¹æ³•. waitæ˜¯å±äºobjectçš„æ–¹æ³•.</p>
<p>â€‹        - sleep æ˜¯è®©æ¸¡cpuæ—¶é—´. è€Œwaitæ˜¯è®©æ¸¡å‡ºä¸´ç•Œèµ„æºçš„æ§åˆ¶æƒ</p>
<h2 id="Java-é”"><a href="#Java-é”" class="headerlink" title="Java é”"></a>Java é”</h2><h3 id="æ‚²è§‚é”"><a href="#æ‚²è§‚é”" class="headerlink" title="æ‚²è§‚é”"></a>æ‚²è§‚é”</h3><p>æ‚²è§‚é”å¯ä»¥å«åšç‹¬å é”, åœ¨å¾—åˆ°è¿™ä¸ªèµ„æºä¹‹ååˆ°è®©æ¸¡å‡ºè¿™ä¸ªèµ„æºä¹‹å‰å…¶ä»–çš„äº‹ç‰©éƒ½ä¸èƒ½è®¿é—®è¿™ä¸ªèµ„æº.</p>
<h3 id="ä¹è§‚é”"><a href="#ä¹è§‚é”" class="headerlink" title="ä¹è§‚é”"></a>ä¹è§‚é”</h3><p>ç›¸å¯¹äºæ‚²è§‚é”, ä¹è§‚é”è®¤ä¸ºåœ¨å¾ˆå¤§çš„ç¨‹åº¦ä¸‹è¿™ä¸ªèµ„æºéƒ½ä¸ä¼šå‘ç”Ÿå˜åŒ– æ‰€ä»¥ä¹Ÿæ²¡æœ‰å¿…è¦è¿›è¡Œç‹¬å (å¤§å®¶éƒ½å¯ä»¥è®¿é—®), åœ¨å‡†å¤‡å¯¹è¿™ä¸ªèµ„æºè¿›è¡Œä¿®æ”¹çš„æ—¶å€™è¦å»éªŒè¯ä¸€ä¸‹è¿™ä¸ªèµ„æºæ˜¯ä¸æ˜¯å‘ç”Ÿå˜åŒ–äº†, å¦‚æœå‘ç”Ÿå˜åŒ–äº†å°±æ”¾å¼ƒä¿®æ”¹, å¦‚æœæ˜¯æ²¡æœ‰å‘ç”Ÿå˜åŒ–,é‚£å°±ä¿®æ”¹å®ƒ. (Compare And Swap)</p>
<h3 id="è‡ªæ—‹é”"><a href="#è‡ªæ—‹é”" class="headerlink" title="è‡ªæ—‹é”"></a>è‡ªæ—‹é”</h3><ul>
<li>è‡ªæ—‹</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> offset = Unsafe.getUnsafe().objectFieldOffset(Stuednt.class.getDeclaredField(&quot;name&quot;));</span><br><span class="line">Object o;</span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">    v = Unsafe.getUnsafe().getObjectVolatile(o, offset); </span><br><span class="line">&#125; <span class="keyword">while</span> (! Unsafe.getUnsafe().compareAndSwapObject(student, offset, v,<span class="string">&quot;new name&quot;</span>);)</span><br></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœæŒæœ‰é”çš„çº¿ç¨‹èƒ½åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…é‡Šæ”¾é”èµ„æº, é‚£ä¹ˆé‚£äº›ç­‰å¾…ç«äº‰é”çš„çº¿ç¨‹å°±ä¸éœ€è¦åšå†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´çš„åˆ‡æ¢è¿›å…¥é˜»å¡æŒ‚èµ·çŠ¶æ€,åªè¦ç­‰ä¸€ç­‰å°±å¥½äº†.</li>
</ul>
<h2 id="Synchronized"><a href="#Synchronized" class="headerlink" title="Synchronized"></a>Synchronized</h2><h3 id="ä½œç”¨èŒƒå›´"><a href="#ä½œç”¨èŒƒå›´" class="headerlink" title="ä½œç”¨èŒƒå›´"></a>ä½œç”¨èŒƒå›´</h3><ul>
<li>ä½œç”¨æ–¹æ³• </li>
<li>ä½œç”¨é™æ€æ–¹æ³•</li>
<li>sychronized(something) </li>
</ul>
<h3 id="æ ¸å¿ƒç»„ä»¶"><a href="#æ ¸å¿ƒç»„ä»¶" class="headerlink" title="æ ¸å¿ƒç»„ä»¶"></a>æ ¸å¿ƒç»„ä»¶</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lykm02/p/4516777.html">è¯¦ç»†è¯´æ˜ </a></p>
<ul>
<li><p>contention list</p>
<p>ç«äº‰é˜Ÿåˆ— æ‰€æœ‰è¯·æ±‚é”çš„çº¿ç¨‹é¦–å…ˆæ”¾åœ¨è¿™ä¸ªç«äº‰é˜Ÿåˆ—ä¸­</p>
</li>
<li><p>entry list</p>
<p>Contention list zhong æœ‰èµ„æ ¼ç§°ä¸ºå€™é€‰èµ„æºçš„çº¿ç¨‹è¢«ç§»åŠ¨åˆ°è¿™ä¸ªç«äº‰é˜Ÿåˆ—ä¸­</p>
</li>
<li><p>wait set</p>
<p>è°ƒç”¨waitçš„çº¿ç¨‹åœ¨è¿™ä¸ªé˜Ÿåˆ—ä¸­</p>
</li>
<li><p>OnDeck </p>
<p>ä»»æ„æ—¶åˆ»æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç«äº‰é”,è¯¥çº¿ç¨‹è¢«ç§°ä¸ºOnDeck</p>
</li>
<li><p>Owner</p>
<p>è·å¾—é”çš„è¿›ç¨‹ç§°ä¸ºOwener</p>
</li>
<li><p>! Owener</p>
<p>é‡Šæ”¾é”çš„çº¿ç¨‹    </p>
</li>
</ul>
<blockquote>
<p><img src="http://img.andrewchen1.top/20121109112521_220.jpg" alt="é˜Ÿåˆ—è¯´æ˜"></p>
<ul>
<li><p><strong>ContentionList</strong> <strong>è™šæ‹Ÿé˜Ÿåˆ—</strong></p>
<p>ContentionList å¹¶ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„Queueï¼Œè€Œåªæ˜¯ä¸€ä¸ªè™šæ‹Ÿé˜Ÿåˆ—ï¼ŒåŸå› åœ¨äºContentionListæ˜¯ç”±NodeåŠå…¶nextæŒ‡ é’ˆé€»è¾‘æ„æˆï¼Œå¹¶ä¸å­˜åœ¨ä¸€ä¸ªQueueçš„æ•°æ®ç»“æ„ã€‚ContentionListæ˜¯ä¸€ä¸ªåè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„é˜Ÿåˆ—ï¼Œæ¯æ¬¡æ–°åŠ å…¥Nodeæ—¶éƒ½ä¼šåœ¨é˜Ÿå¤´è¿›è¡Œï¼Œ é€šè¿‡CASæ”¹å˜ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„çš„æŒ‡é’ˆä¸ºæ–°å¢èŠ‚ç‚¹ï¼ŒåŒæ—¶è®¾ç½®æ–°å¢èŠ‚ç‚¹çš„nextæŒ‡å‘åç»­èŠ‚ç‚¹ï¼Œè€Œå–å¾—æ“ä½œåˆ™å‘ç”Ÿåœ¨é˜Ÿå°¾ã€‚æ˜¾ç„¶ï¼Œè¯¥ç»“æ„å…¶å®æ˜¯ä¸ªLock- Freeçš„é˜Ÿåˆ—ã€‚ </p>
<p>å› ä¸ºåªæœ‰Ownerçº¿ç¨‹æ‰èƒ½ä»é˜Ÿå°¾å–å…ƒç´ ï¼Œä¹Ÿå³çº¿ç¨‹å‡ºåˆ—æ“ä½œæ— äº‰ç”¨ï¼Œå½“ç„¶ä¹Ÿå°±é¿å…äº†CASçš„ABAé—®é¢˜ã€‚</p>
<p><img src="http://img.andrewchen1.top/20121109112521_981.jpg" alt="LIFO"></p>
</li>
<li><p>EntryList</p>
<p>EntryListä¸ContentionListé€»è¾‘ä¸ŠåŒå±ç­‰å¾…é˜Ÿåˆ—ï¼ŒContentionListä¼šè¢«çº¿ç¨‹å¹¶å‘è®¿é—®ï¼Œä¸ºäº†é™ä½å¯¹ ContentionListé˜Ÿå°¾çš„äº‰ç”¨ï¼Œè€Œå»ºç«‹EntryListã€‚Ownerçº¿ç¨‹åœ¨unlockæ—¶ä¼šä»ContentionListä¸­è¿ç§»çº¿ç¨‹åˆ° EntryListï¼Œå¹¶ä¼šæŒ‡å®šEntryListä¸­çš„æŸä¸ªçº¿ç¨‹ï¼ˆä¸€èˆ¬ä¸ºHeadï¼‰ä¸ºReadyï¼ˆOnDeckï¼‰çº¿ç¨‹ã€‚Ownerçº¿ç¨‹å¹¶ä¸æ˜¯æŠŠé”ä¼ é€’ç»™ OnDeckçº¿ç¨‹ï¼Œåªæ˜¯æŠŠç«äº‰é”çš„æƒåˆ©äº¤ç»™OnDeckï¼ŒOnDeckçº¿ç¨‹éœ€è¦é‡æ–°ç«äº‰é”ã€‚è¿™æ ·åšè™½ç„¶ç‰ºç‰²äº†ä¸€å®šçš„å…¬å¹³æ€§ï¼Œä½†æå¤§çš„æé«˜äº†æ•´ä½“ååé‡ï¼Œåœ¨ Hotspotä¸­æŠŠOnDeckçš„é€‰æ‹©è¡Œä¸ºç§°ä¹‹ä¸ºâ€œç«äº‰åˆ‡æ¢â€ã€‚ </p>
<p>OnDeckçº¿ç¨‹è·å¾—é”åå³å˜ä¸ºownerçº¿ç¨‹ï¼Œæ— æ³•è·å¾—é”åˆ™ä¼šä¾ç„¶ç•™åœ¨EntryListä¸­ï¼Œè€ƒè™‘åˆ°å…¬å¹³æ€§ï¼Œåœ¨EntryListä¸­çš„ä½ç½®ä¸ å‘ç”Ÿå˜åŒ–ï¼ˆä¾ç„¶åœ¨é˜Ÿå¤´ï¼‰ã€‚å¦‚æœOwnerçº¿ç¨‹è¢«waitæ–¹æ³•é˜»å¡ï¼Œåˆ™è½¬ç§»åˆ°WaitSeté˜Ÿåˆ—ï¼›å¦‚æœåœ¨æŸä¸ªæ—¶åˆ»è¢«notify/notifyAllå”¤é†’ï¼Œ åˆ™å†æ¬¡è½¬ç§»åˆ°EntryListã€‚</p>
</li>
<li><p>è‡ªæ—‹é”</p>
<p>é‚£äº›å¤„äºContetionListã€EntryListã€WaitSetä¸­çš„çº¿ç¨‹å‡å¤„äºé˜»å¡çŠ¶æ€ï¼Œé˜»å¡æ“ä½œç”±æ“ä½œç³»ç»Ÿå®Œæˆï¼ˆåœ¨Linxuä¸‹é€š è¿‡pthread_mutex_lockå‡½æ•°ï¼‰<em>LockSupport.park() LockSupport.unPark()</em>ã€‚çº¿ç¨‹è¢«é˜»å¡åä¾¿è¿›å…¥å†…æ ¸ï¼ˆLinuxï¼‰è°ƒåº¦çŠ¶æ€ï¼Œè¿™ä¸ªä¼šå¯¼è‡´ç³»ç»Ÿåœ¨ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œä¸¥é‡å½±å“ é”çš„æ€§èƒ½ </p>
<p>ç¼“è§£ä¸Šè¿°é—®é¢˜çš„åŠæ³•ä¾¿æ˜¯è‡ªæ—‹ï¼Œå…¶åŸç†æ˜¯ï¼šå½“å‘ç”Ÿäº‰ç”¨æ—¶ï¼Œè‹¥Ownerçº¿ç¨‹èƒ½åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…é‡Šæ”¾é”ï¼Œåˆ™é‚£äº›æ­£åœ¨äº‰ç”¨çº¿ç¨‹å¯ä»¥ç¨å¾®ç­‰ä¸€ç­‰ï¼ˆè‡ªæ—‹ï¼‰ï¼Œ åœ¨Ownerçº¿ç¨‹é‡Šæ”¾é”åï¼Œäº‰ç”¨çº¿ç¨‹å¯èƒ½ä¼šç«‹å³å¾—åˆ°é”ï¼Œä»è€Œé¿å…äº†ç³»ç»Ÿé˜»å¡ã€‚ä½†Ownerè¿è¡Œçš„æ—¶é—´å¯èƒ½ä¼šè¶…å‡ºäº†ä¸´ç•Œå€¼ï¼Œäº‰ç”¨çº¿ç¨‹è‡ªæ—‹ä¸€æ®µæ—¶é—´åè¿˜æ˜¯æ— æ³• è·å¾—é”ï¼Œè¿™æ—¶äº‰ç”¨çº¿ç¨‹åˆ™ä¼šåœæ­¢è‡ªæ—‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼ˆåé€€ï¼‰ã€‚åŸºæœ¬æ€è·¯å°±æ˜¯è‡ªæ—‹ï¼Œä¸æˆåŠŸå†é˜»å¡ï¼Œå°½é‡é™ä½é˜»å¡çš„å¯èƒ½æ€§ï¼Œè¿™å¯¹é‚£äº›æ‰§è¡Œæ—¶é—´å¾ˆçŸ­çš„ä»£ç å—æ¥è¯´æœ‰é å¸¸é‡è¦çš„æ€§èƒ½æé«˜ã€‚è‡ªæ—‹é”æœ‰ä¸ªæ›´è´´åˆ‡çš„åå­—ï¼šè‡ªæ—‹-æŒ‡æ•°åé€€é”ï¼Œä¹Ÿå³å¤åˆé”ã€‚å¾ˆæ˜¾ç„¶ï¼Œè‡ªæ—‹åœ¨å¤šå¤„ç†å™¨ä¸Šæ‰æœ‰æ„ä¹‰ã€‚ </p>
<p>è¿˜æœ‰ä¸ªé—®é¢˜æ˜¯ï¼Œçº¿ç¨‹è‡ªæ—‹æ—¶åšäº›å•¥ï¼Ÿå…¶å®å•¥éƒ½ä¸åšï¼Œå¯ä»¥æ‰§è¡Œå‡ æ¬¡forå¾ªç¯ï¼Œå¯ä»¥æ‰§è¡Œå‡ æ¡ç©ºçš„æ±‡ç¼–æŒ‡ä»¤ï¼Œç›®çš„æ˜¯å ç€CPUä¸æ”¾ï¼Œç­‰å¾…è·å–é”çš„æœº ä¼šã€‚æ‰€ä»¥è¯´ï¼Œè‡ªæ—‹æ˜¯æŠŠåŒåˆƒå‰‘ï¼Œå¦‚æœæ—‹çš„æ—¶é—´è¿‡é•¿ä¼šå½±å“æ•´ä½“æ€§èƒ½ï¼Œæ—¶é—´è¿‡çŸ­åˆè¾¾ä¸åˆ°å»¶è¿Ÿé˜»å¡çš„ç›®çš„ã€‚æ˜¾ç„¶ï¼Œè‡ªæ—‹çš„å‘¨æœŸé€‰æ‹©æ˜¾å¾—éå¸¸é‡è¦ï¼Œä½†è¿™ä¸æ“ä½œç³»ç»Ÿã€ç¡¬ ä»¶ä½“ç³»ã€ç³»ç»Ÿçš„è´Ÿè½½ç­‰è¯¸å¤šåœºæ™¯ç›¸å…³ï¼Œå¾ˆéš¾é€‰æ‹©ï¼Œå¦‚æœé€‰æ‹©ä¸å½“ï¼Œä¸ä½†æ€§èƒ½å¾—ä¸åˆ°æé«˜ï¼Œå¯èƒ½è¿˜ä¼šä¸‹é™ï¼Œå› æ­¤å¤§å®¶æ™®éè®¤ä¸ºè‡ªæ—‹é”ä¸å…·æœ‰æ‰©å±•æ€§ã€‚ </p>
<p>è‡ªæ—‹ä¼˜åŒ–ç­–ç•¥ </p>
<p>å¯¹è‡ªæ—‹é”å‘¨æœŸçš„é€‰æ‹©ä¸Šï¼ŒHotSpotè®¤ä¸ºæœ€ä½³æ—¶é—´åº”æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶é—´ï¼Œä½†ç›®å‰å¹¶æ²¡æœ‰åšåˆ°ã€‚ç»è¿‡è°ƒæŸ¥ï¼Œç›®å‰åªæ˜¯é€šè¿‡æ±‡ç¼–æš‚åœäº†å‡ ä¸ªCPUå‘¨æœŸï¼Œé™¤äº†è‡ªæ—‹å‘¨æœŸé€‰æ‹©ï¼ŒHotSpotè¿˜è¿›è¡Œè®¸å¤šå…¶ä»–çš„è‡ªæ—‹ä¼˜åŒ–ç­–ç•¥ï¼Œå…·ä½“å¦‚ä¸‹ï¼š </p>
<p>å¦‚æœå¹³å‡è´Ÿè½½å°äºCPUsåˆ™ä¸€ç›´è‡ªæ—‹ </p>
<p>å¦‚æœæœ‰è¶…è¿‡(CPUs/2)ä¸ªçº¿ç¨‹æ­£åœ¨è‡ªæ—‹ï¼Œåˆ™åæ¥çº¿ç¨‹ç›´æ¥é˜»å¡ </p>
<p>å¦‚æœæ­£åœ¨è‡ªæ—‹çš„çº¿ç¨‹å‘ç°Ownerå‘ç”Ÿäº†å˜åŒ–åˆ™å»¶è¿Ÿè‡ªæ—‹æ—¶é—´ï¼ˆè‡ªæ—‹è®¡æ•°ï¼‰æˆ–è¿›å…¥é˜»å¡ </p>
<p>å¦‚æœCPUå¤„äºèŠ‚ç”µæ¨¡å¼åˆ™åœæ­¢è‡ªæ—‹ </p>
<p>è‡ªæ—‹æ—¶é—´çš„æœ€åæƒ…å†µæ˜¯CPUçš„å­˜å‚¨å»¶è¿Ÿï¼ˆCPU Aå­˜å‚¨äº†ä¸€ä¸ªæ•°æ®ï¼Œåˆ°CPU Bå¾—çŸ¥è¿™ä¸ªæ•°æ®ç›´æ¥çš„æ—¶é—´å·®ï¼‰ </p>
<p>è‡ªæ—‹æ—¶ä¼šé€‚å½“æ”¾å¼ƒçº¿ç¨‹ä¼˜å…ˆçº§ä¹‹é—´çš„å·®å¼‚ </p>
<p>é‚£synchronizedå®ç°ä½•æ—¶ä½¿ç”¨äº†è‡ªæ—‹é”ï¼Ÿç­”æ¡ˆæ˜¯åœ¨çº¿ç¨‹è¿›å…¥ContentionListæ—¶ï¼Œä¹Ÿå³ç¬¬ä¸€æ­¥æ“ä½œå‰ã€‚çº¿ç¨‹åœ¨è¿›å…¥ç­‰å¾…é˜Ÿåˆ—æ—¶ é¦–å…ˆè¿›è¡Œè‡ªæ—‹å°è¯•è·å¾—é”ï¼Œå¦‚æœä¸æˆåŠŸå†è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚è¿™å¯¹é‚£äº›å·²ç»åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹æ¥è¯´ï¼Œç¨å¾®æ˜¾å¾—ä¸å…¬å¹³ã€‚è¿˜æœ‰ä¸€ä¸ªä¸å…¬å¹³çš„åœ°æ–¹æ˜¯è‡ªæ—‹çº¿ç¨‹å¯èƒ½ä¼šæŠ¢å äº† Readyçº¿ç¨‹çš„é”ã€‚è‡ªæ—‹é”ç”±æ¯ä¸ªç›‘è§†å¯¹è±¡ç»´æŠ¤ï¼Œæ¯ä¸ªç›‘è§†å¯¹è±¡ä¸€ä¸ªã€‚</p>
</li>
<li><p>åå‘é”</p>
<p>åœ¨JVM1.6ä¸­å¼•å…¥äº†åå‘é”ï¼Œåå‘é”ä¸»è¦è§£å†³æ— ç«äº‰ä¸‹çš„é”æ€§èƒ½é—®é¢˜ï¼Œé¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹æ— ç«äº‰ä¸‹é”å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼š </p>
<p>ç°åœ¨å‡ ä¹æ‰€æœ‰çš„é”éƒ½æ˜¯å¯é‡å…¥çš„ï¼Œä¹Ÿå³å·²ç»è·å¾—é”çš„çº¿ç¨‹å¯ä»¥å¤šæ¬¡é”ä½/è§£é”ç›‘è§†å¯¹è±¡ï¼ŒæŒ‰ç…§ä¹‹å‰çš„HotSpotè®¾è®¡ï¼Œæ¯æ¬¡åŠ é”/è§£é”éƒ½ä¼šæ¶‰åŠåˆ°ä¸€äº› CASæ“ ä½œï¼ˆæ¯”å¦‚å¯¹ç­‰å¾…é˜Ÿåˆ—çš„CASæ“ä½œï¼‰ï¼ŒCASæ“ä½œä¼šå»¶è¿Ÿæœ¬åœ°è°ƒç”¨ï¼Œå› æ­¤åå‘é”çš„æƒ³æ³•æ˜¯ä¸€æ—¦çº¿ç¨‹ç¬¬ä¸€æ¬¡è·å¾—äº†ç›‘è§†å¯¹è±¡ï¼Œä¹‹åè®©ç›‘è§†å¯¹è±¡â€œåå‘â€è¿™ä¸ª çº¿ç¨‹ï¼Œä¹‹åçš„å¤šæ¬¡è°ƒç”¨åˆ™å¯ä»¥é¿å…CASæ“ä½œï¼Œè¯´ç™½äº†å°±æ˜¯ç½®ä¸ªå˜é‡ï¼Œå¦‚æœå‘ç°ä¸ºtrueåˆ™æ— éœ€å†èµ°å„ç§åŠ é”/è§£é”æµç¨‹ã€‚ä½†è¿˜æœ‰å¾ˆå¤šæ¦‚å¿µéœ€è¦è§£é‡Šã€å¾ˆå¤šå¼•å…¥çš„ é—®é¢˜éœ€è¦è§£å†³ï¼š</p>
<p><img src="http://img.andrewchen1.top/20121109112521_777.jpg" alt="SMP"></p>
<p>å…¶æ„æ€æ˜¯æ‰€æœ‰çš„CPUä¼šå…±äº«ä¸€æ¡ç³»ç»Ÿæ€»çº¿ï¼ˆBUSï¼‰ï¼Œé æ­¤æ€»çº¿è¿æ¥ä¸»å­˜ã€‚æ¯ä¸ªæ ¸éƒ½æœ‰è‡ªå·±çš„ä¸€çº§ç¼“å­˜ï¼Œå„æ ¸ç›¸å¯¹äºBUSå¯¹ç§°åˆ†å¸ƒï¼Œå› æ­¤è¿™ç§ç»“æ„ç§°ä¸ºâ€œå¯¹ç§°å¤šå¤„ç†å™¨â€ã€‚ </p>
<p>è€ŒCASçš„å…¨ç§°ä¸ºCompare-And-Swapï¼Œæ˜¯ä¸€æ¡CPUçš„åŸå­æŒ‡ä»¤ï¼Œå…¶ä½œç”¨æ˜¯è®©CPUæ¯”è¾ƒååŸå­åœ°æ›´æ–°æŸä¸ªä½ç½®çš„å€¼ï¼Œç»è¿‡è°ƒæŸ¥å‘ç°ï¼Œ å…¶å®ç°æ–¹å¼æ˜¯åŸºäºç¡¬ä»¶å¹³å°çš„æ±‡ç¼–æŒ‡ä»¤ï¼Œå°±æ˜¯è¯´CASæ˜¯é ç¡¬ä»¶å®ç°çš„ï¼ŒJVMåªæ˜¯å°è£…äº†æ±‡ç¼–è°ƒç”¨ï¼Œé‚£äº›AtomicIntegerç±»ä¾¿æ˜¯ä½¿ç”¨äº†è¿™äº›å°è£…åçš„ æ¥å£ã€‚ </p>
<p>Core1å’ŒCore2å¯èƒ½ä¼šåŒæ—¶æŠŠä¸»å­˜ä¸­æŸä¸ªä½ç½®çš„å€¼Loadåˆ°è‡ªå·±çš„L1 Cacheä¸­ï¼Œå½“Core1åœ¨è‡ªå·±çš„L1 Cacheä¸­ä¿®æ”¹è¿™ä¸ªä½ç½®çš„å€¼æ—¶ï¼Œä¼šé€šè¿‡æ€»çº¿ï¼Œä½¿Core2ä¸­L1 Cacheå¯¹åº”çš„å€¼â€œå¤±æ•ˆâ€ï¼Œè€ŒCore2ä¸€æ—¦å‘ç°è‡ªå·±L1 Cacheä¸­çš„å€¼å¤±æ•ˆï¼ˆç§°ä¸ºCacheå‘½ä¸­ç¼ºå¤±ï¼‰åˆ™ä¼šé€šè¿‡æ€»çº¿ä»å†…å­˜ä¸­åŠ è½½è¯¥åœ°å€æœ€æ–°çš„å€¼ï¼Œå¤§å®¶é€šè¿‡æ€»çº¿çš„æ¥å›é€šä¿¡ç§°ä¸ºâ€œCacheä¸€è‡´æ€§æµé‡â€ï¼Œå› ä¸ºæ€» çº¿è¢«è®¾è®¡ä¸ºå›ºå®šçš„â€œé€šä¿¡èƒ½åŠ›â€ï¼Œå¦‚æœCacheä¸€è‡´æ€§æµé‡è¿‡å¤§ï¼Œæ€»çº¿å°†æˆä¸ºç“¶é¢ˆã€‚è€Œå½“Core1å’ŒCore2ä¸­çš„å€¼å†æ¬¡ä¸€è‡´æ—¶ï¼Œç§°ä¸ºâ€œCacheä¸€è‡´ æ€§â€ï¼Œä»è¿™ä¸ªå±‚é¢æ¥è¯´ï¼Œé”è®¾è®¡çš„ç»ˆæç›®æ ‡ä¾¿æ˜¯å‡å°‘Cacheä¸€è‡´æ€§æµé‡ã€‚ </p>
<p>è€ŒCASæ°å¥½ä¼šå¯¼è‡´Cacheä¸€è‡´æ€§æµé‡ï¼Œå¦‚æœæœ‰å¾ˆå¤šçº¿ç¨‹éƒ½å…±äº«åŒä¸€ä¸ªå¯¹è±¡ï¼Œå½“æŸä¸ªCore CASæˆåŠŸæ—¶å¿…ç„¶ä¼šå¼•èµ·æ€»çº¿é£æš´ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æœ¬åœ°å»¶è¿Ÿï¼Œæœ¬è´¨ä¸Šåå‘é”å°±æ˜¯ä¸ºäº†æ¶ˆé™¤CASï¼Œé™ä½Cacheä¸€è‡´æ€§æµé‡ã€‚</p>
</li>
</ul>
<p>  ä¸Šé¢æåˆ°Cacheä¸€è‡´æ€§ï¼Œå…¶å®æ˜¯æœ‰åè®®æ”¯æŒçš„ï¼Œç°åœ¨é€šç”¨çš„åè®®æ˜¯MESIï¼ˆæœ€æ—©ç”±Intelå¼€å§‹æ”¯æŒï¼‰ï¼Œå…·ä½“å‚è€ƒï¼š<a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/MESI_protocol">http://en.wikipedia.org/wiki/MESI_protocol</a>ï¼Œä»¥åä¼šä»”ç»†è®²è§£è¿™éƒ¨åˆ†ã€‚</p>
<p>  å…¶å®ä¹Ÿä¸æ˜¯æ‰€æœ‰çš„CASéƒ½ä¼šå¯¼è‡´æ€»çº¿é£æš´ï¼Œè¿™è·ŸCacheä¸€è‡´æ€§åè®®æœ‰å…³ï¼Œå…·ä½“å‚è€ƒï¼š<a target="_blank" rel="noopener" href="http://blogs.oracle.com/dave/entry/biased_locking_in_hotspot">http://blogs.oracle.com/dave/entry/biased_locking_in_hotspot</a></p>
<p>  NUMA(Non Uniform Memory Access Achitectureï¼‰æ¶æ„ï¼š </p>
<p>  ä¸SMPå¯¹åº”è¿˜æœ‰éå¯¹ç§°å¤šå¤„ç†å™¨æ¶æ„ï¼Œç°åœ¨ä¸»è¦åº”ç”¨åœ¨ä¸€äº›é«˜ç«¯å¤„ç†å™¨ä¸Šï¼Œä¸»è¦ç‰¹ç‚¹æ˜¯æ²¡æœ‰æ€»çº¿ï¼Œæ²¡æœ‰å…¬ç”¨ä¸»å­˜ï¼Œæ¯ä¸ªCoreæœ‰è‡ªå·±çš„å†…å­˜ï¼Œé’ˆå¯¹è¿™ç§ç»“æ„æ­¤å¤„ä¸åšè®¨è®ºã€‚</p>
</blockquote>
<h3 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h3><p>ä»–æ˜¯ä¸€ç§é‡å…¥é”,é™¤äº†èƒ½å®Œæˆsychronizedæ‰€èƒ½å®Œæˆçš„æ‰€æœ‰å·¥ä½œä¹‹å¤–,è¿˜æä¾›äº†è¯¸å¦‚å¯å“åº”ä¸­æ–­é”ã€å¯è½®è®­é”ã€å®šæ—¶é”èƒ½é¿å…å¤šçº¿ç¨‹æ­»é”çš„æ–¹æ³•.</p>
<ol>
<li><p>void lock() </p>
<p>å¦‚æœé”å¤„äºç©ºé—²çš„çŠ¶æ€,å½“å‰çº¿ç¨‹å°†è·å¾—é”</p>
</li>
<li><p>boolean tryLock() </p>
<p>å¦‚æœé”å¯ç”¨,åˆ™è·å¾—é”,å¹¶ä¸”ç«‹å³è¿”å›true,å¦åˆ™è¿”å›false.tryLockåªæ˜¯â€è¯•å›¾â€è·å–é”,å¦‚æœé”ä¸å¯ç”¨,ä¸ä¼šå¯¼è‡´è¿™ä¸ªçº¿ç¨‹å¤„äºwaitçŠ¶æ€</p>
</li>
<li><p>void unlock()</p>
<p>å½“å‰çº¿ç¨‹å°†é‡Šæ”¾æŒæœ‰çš„é”</p>
</li>
<li><p>Condition newCondition()</p>
<p>æ¡ä»¶å¯¹è±¡,è·å–ç­‰å¾…é€šçŸ¥ç»„ä»¶. è¯¥ç»„ä»¶å’Œå½“å‰çš„é”ç»‘å®š.<strong>å½“å‰çº¿ç¨‹åªæœ‰æ‹¥æœ‰äº†é”</strong>,æ‰èƒ½è°ƒç”¨è¯¥ç»„ä»¶çš„await()æ–¹æ³•.è€Œè°ƒç”¨äº†ä¹‹å,å½“å‰çº¿ç¨‹ä¼šé‡Šæ”¾lock, è¢«åŠ å…¥åˆ°è¿™ä¸ªconditionçš„ç­‰å¾…é˜Ÿåˆ—ä¸­,è¿™ä¸ªçº¿ç¨‹ä¸å†ä¼šæ´»åŠ¨,until å…¶ä»–çº¿ç¨‹æ“ä½œè¿™ä¸ªconditional è°ƒç”¨signal()æˆ–è€… signalAll(). è¢«awaitçš„çº¿ç¨‹ä¼šåˆ°lockçš„ç«äº‰é˜Ÿåˆ—ä¸­å»ç«äº‰condition.</p>
</li>
<li><p>int getHoldCount()</p>
<p>æŸ¥è¯¢å½“å‰çº¿ç¨‹ä¿æŒæ­¤é”çš„æ¬¡æ•°, é‡å…¥çš„æ¬¡æ•°,ä¹Ÿå°±æ˜¯æ‰§è¡Œæ­¤çº¿ç¨‹æ‰§è¡Œlockæ–¹æ³•çš„æ¬¡æ•°</p>
</li>
<li><p>int getQueueLength()</p>
<p>è¿”å›æ­£ç­‰å¾…è·å–æ­¤é”çš„çº¿ç¨‹æ•°é‡</p>
</li>
<li><p>int getWaitQueueLength(Condition condition)</p>
<p>è¿”å›ç­‰å¾…ä¸æ­¤é”ç›¸å…³çš„ç»™å®šæ¡ä»¶çº¿ç¨‹ä¼°è®¡æ•°.æ¯”æ–¹è¯´10ä¸ªçº¿ç¨‹,ç”¨åŒä¸€ä¸ªconditionå¯¹è±¡,è€Œä¸”10å¯¹è±¡éƒ½æ‰§è¡Œäº†awaitçš„æ–¹æ³•.é‚£ä¹ˆè¿”å›çš„å€¼ä¸º10</p>
</li>
<li><p>bool hasWaiters(Condition condition)</p>
<p>æŸä¸ªCondition æ˜¯å¦æœ‰ç­‰å¾…çš„Threadæ•°é‡</p>
</li>
<li><p>boolean hasQueuedThread(Thread thread)</p>
<p>æŸ¥è¯¢ç»™å®šçš„çº¿ç¨‹æ˜¯å¦æ‹¥æœ‰è¿™ä¸ªé”</p>
</li>
<li><p>boolean hasQueuedThreads()</p>
<p>æ˜¯å¦æœ‰çº¿ç¨‹åœ¨ç­‰å¾…è¿™ä¸ªlock</p>
</li>
<li><p>isFair()</p>
<p>æ˜¯å¦æ˜¯å…¬å¹³é”</p>
</li>
<li><p>isHeldByCurrentThread()</p>
<p>è¿™ä¸ªlockæ˜¯ä¸æ˜¯è¢«å½“å‰çº¿ç¨‹å æœ‰</p>
</li>
<li><p>isLock()</p>
<p>è¿™ä¸ªé”æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹å ç”¨</p>
</li>
<li><p>lockInterruptibly()</p>
<p>å°è¯•è·å–é”,ä»…åœ¨è°ƒç”¨æ—¶é”æœªè¢«ä¸­æ–­,è·å–é”</p>
</li>
<li><p>tryLock(Long timeout, TimeUnit unit)</p>
<p>åœ¨ç»™å®šçš„æ—¶é—´å†…å°è¯•è·å–é”,å¦‚æœæ²¡æœ‰è·å–åˆ°,åˆ™æ”¾å¼ƒ</p>
</li>
</ol>
<h3 id="å…¬å¹³é”å’Œéå…¬å¹³é”"><a href="#å…¬å¹³é”å’Œéå…¬å¹³é”" class="headerlink" title="å…¬å¹³é”å’Œéå…¬å¹³é”"></a>å…¬å¹³é”å’Œéå…¬å¹³é”</h3><p>JVM æŒ‰éšæœºã€å°±è¿‘åŸåˆ™åˆ†é…åŸåˆ™é”çš„æœºåˆ¶åˆ™ç§°ä¸ºä¸å…¬å¹³é”,æŒ‰ç…§å¯¹é”æå‡ºè·å–è¯·æ±‚çš„å…ˆåé¡ºåºåˆ†é…åˆ°é”çš„æœºåˆ¶è¢«ç§°ä¸ºå…¬å¹³é”</p>
<h3 id="ReetrantLock-ä¸-Sychronized"><a href="#ReetrantLock-ä¸-Sychronized" class="headerlink" title="ReetrantLock ä¸ Sychronized"></a>ReetrantLock ä¸ Sychronized</h3><p>reetrantLocké€šè¿‡lock()å’Œunlock() å®ç°åŠ é”å’Œè§£é”. ReetrantLock å¿…é¡»åœ¨finallyæ§åˆ¶å—ä¸­è¿›è¡Œè§£é”æ“ä½œ.</p>
<h3 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h3><p>Semaphoreæ˜¯ä¸€ç§åŸºäºåŸºæ•°çš„å‹å·é‡.å®ƒå¯ä»¥è®¾å®šä¸€ä¸ªé˜ˆå€¼.å¤šä¸ªçº¿ç¨‹è·å–è®¸å¯å‹å·(acquire),åšå®Œè‡ªå·±çš„ç”³è¯·åå½’è¿˜(release)</p>
<h3 id="å…±äº«é”å’Œç‹¬å é”"><a href="#å…±äº«é”å’Œç‹¬å é”" class="headerlink" title="å…±äº«é”å’Œç‹¬å é”"></a>å…±äº«é”å’Œç‹¬å é”</h3><p>ç‹¬å é”æ¨¡å¼ä¸‹,æ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰é”.å…±äº«é”å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–é”,å¹¶å‘å…±äº«èµ„æº. æ¯”æ–¹è¯´ReadWriteLock.</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th>READ</th>
<th>WRITE</th>
</tr>
</thead>
<tbody><tr>
<td align="center">READ</td>
<td>â˜‘ï¸</td>
<td>âœ–ï¸</td>
</tr>
<tr>
<td align="center">WRITE</td>
<td>âœ–ï¸</td>
<td>âœ–ï¸</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReadWriteReetraintLock</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›®å‰æ­£åœ¨è¯»çš„æ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Integer readerNumber;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ­£åœ¨è¯»çš„æ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Integer writerNumber;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyReadWriteReetraintLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        readerNumber = <span class="number">0</span>;</span><br><span class="line">        writerNumber = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">tryRead</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (writerNumber &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            wait();</span><br><span class="line">        &#125;</span><br><span class="line">        readerNumber ++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">readDone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        readerNumber --;</span><br><span class="line">        notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">tryWrite</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (readerNumber &gt; <span class="number">0</span> || writerNumber &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            wait();</span><br><span class="line">        &#125;</span><br><span class="line">        writerNumber ++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">writeDone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        writerNumber --;</span><br><span class="line">        notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Interrupt"><a href="#Interrupt" class="headerlink" title="Interrupt"></a>Interrupt</h3><p>ä¸­æ–­ä¸€ä¸ªçº¿ç¨‹,æœ¬æ„æ˜¯ç»™è¿™ä¸ªçº¿ç¨‹ä¸€ä¸ªé€šçŸ¥ä¿¡å·,ä¼šå½±å“è¿™ä¸ªçº¿ç¨‹å†…éƒ¨ä¸€ä¸ªä¸­æ–­æ ‡è¯†.</p>
<ul>
<li>è¿è¡Œä¸­çš„çº¿ç¨‹ä¸èƒ½å“åº”interrupt. ä½†æ˜¯æ ‡è¯†ä½ä¼šè¢«è®¾ç½®.å¯ä»¥é€šè¿‡isInterruptedæ–¹æ³•æ¥çŸ¥æ™“æ ‡è¯†ä½çš„çŠ¶æ€</li>
<li>åœ¨é˜»å¡çŠ¶æ€çš„è¿›ç¨‹è¢«è°ƒç”¨interruptæ–¹æ³•ä¼šæŠ›å‡ºInterruptedException, åœ¨æŠ›å‡ºé”™è¯¯åä¼šå°†æ ‡è¯†ä½æ¸…é™¤.</li>
</ul>
<h3 id="çº¿ç¨‹æ± çš„ç»„æˆ"><a href="#çº¿ç¨‹æ± çš„ç»„æˆ" class="headerlink" title="çº¿ç¨‹æ± çš„ç»„æˆ"></a>çº¿ç¨‹æ± çš„ç»„æˆ</h3><ul>
<li>çº¿ç¨‹æ± ç®¡ç†å™¨</li>
<li>å·¥ä½œçº¿ç¨‹</li>
<li>ä»»åŠ¡æ¥å£</li>
<li>ä»»åŠ¡é˜Ÿåˆ—</li>
</ul>
<p>æ„å»ºä¸€ä¸ªçº¿ç¨‹æ± </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ExecutorService threadPool = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">                Runtime.getRuntime().availableProcessors(),</span><br><span class="line">                <span class="number">10</span>, </span><br><span class="line">                <span class="number">100</span>, </span><br><span class="line">                TimeUnit.SECONDS, </span><br><span class="line">                <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;(),</span><br><span class="line">                <span class="keyword">new</span> ThreadPoolExecutor.CallerRunsPolicy());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ‹’ç»ç­–ç•¥"><a href="#æ‹’ç»ç­–ç•¥" class="headerlink" title="æ‹’ç»ç­–ç•¥"></a>æ‹’ç»ç­–ç•¥</h4><p>å½“çº¿ç¨‹æ± é‡Œé¢æ‰€æœ‰çš„çº¿ç¨‹éƒ½åœ¨è¿è¡Œä¸­, å¹¶ä¸”é˜Ÿåˆ—éƒ½æ»¡äº†æƒ…å†µä¸‹æœ‰è‹¥å¹²çš„æ‹’ç»æ–¹å¼</p>
<ul>
<li><p>AbortPolicy  </p>
<p>ç›´æ¥æŠ›å‡ºå¼‚å¸¸,é˜»æ­¢ç³»ç»Ÿæ­£å¸¸è¿è¡Œ</p>
</li>
<li><p>CellerRunsPolicy</p>
</li>
</ul>
<p>â€‹    è¯¥ç­–ç•¥ç›´æ¥åœ¨è°ƒç”¨è€…çº¿ç¨‹ä¸­è¿è¡Œå½“å‰è¢«ä¸¢å¼ƒçš„ä»»åŠ¡. ä¼˜ç‚¹ä¸ä¼šçœŸçš„ä¸¢å¼ƒä»»åŠ¡. ä½†æ˜¯ä»»åŠ¡æäº¤çš„æ€§èƒ½å¯èƒ½ä¼šæ€¥å‰§ä¸‹é™</p>
<ul>
<li>DiscardOldestPolicy</li>
</ul>
<p>â€‹    æŠ›å¼ƒé˜Ÿåˆ—ä¸­æœ€è€çš„çº¿ç¨‹</p>
<ul>
<li>DiscardPolicy</li>
</ul>
<p>â€‹    é»˜é»˜çš„ä¸¢å¼ƒå°†è¦å¤„ç†çš„ä»»åŠ¡ä¸åšä»»ä½•çš„å¤„ç†</p>
<h3 id="çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹"><a href="#çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹" class="headerlink" title="çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹"></a>çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹</h3><p>å½“è°ƒç”¨execute()æ–¹æ³•æ·»åŠ ä¸€ä¸ªä»»åŠ¡çš„æ—¶å€™,çº¿ç¨‹æ± ä¼šåšå¦‚ä¸‹åˆ¤æ–­:</p>
<p>a. å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äºcorePoolSize, ä¼šé©¬ä¸Šåˆ›å»ºçº¿ç¨‹è¿è¡Œè¿™ä¸ªä»»åŠ¡</p>
<p>b. å¦‚æœè¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–è€…ç­‰äºcorePoolSize ä¼šå°†è¿™ä¸ªä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—</p>
<p>c. å¦‚æœé˜Ÿåˆ—æ»¡äº†, çº¿ç¨‹æ•°é‡å°äºmaximumPoolSize, é‚£ä¹ˆè¿˜æ˜¯è¦åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹æ¥è¿è¡Œè¿™ä¸ªä»»åŠ¡</p>
<p>f. å¦‚æœé˜Ÿåˆ—æ»¡äº†,è€Œä¸”ç°åœ¨æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–è€…ç­‰äºmaximumPoolSize,é‚£ä¹ˆçº¿ç¨‹æ± ä¼šæŠ›å‡ºRejectExecutionExecution;</p>
<p>å½“ä¸€ä¸ªçº¿ç¨‹æ— äº‹å¯åš,è¶…è¿‡ä¸€å®šæ—¶é—´,çº¿ç¨‹æ± ä¼šåˆ¤æ–­,å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºcorePoolSize,é‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±ä¼šè¢«åœæ‰,æœ€ç»ˆçº¿ç¨‹æ± ä¼šè¢«å‹ç¼©åˆ°corePoolSizeçš„å¤§å°</p>
<p>é˜Ÿåˆ—çš„æ–¹æ³•</p>
<table>
<thead>
<tr>
<th></th>
<th>æ’å…¥</th>
<th>ç§»é™¤</th>
<th>æ£€æŸ¥</th>
</tr>
</thead>
<tbody><tr>
<td>ä¼šæŠ›å‡ºå¼‚å¸¸</td>
<td>add</td>
<td>remove</td>
<td>element</td>
</tr>
<tr>
<td>ä¸ä¼šæŠ›å‡ºå¼‚å¸¸</td>
<td>offer</td>
<td>poll</td>
<td>peek</td>
</tr>
<tr>
<td>é˜»å¡</td>
<td>put</td>
<td>take</td>
<td></td>
</tr>
</tbody></table>
<ul>
<li><p>ArrayBlockingQueue</p>
<p>æ•°ç»„å½¢å¼å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</p>
</li>
<li><p>LinkedBlockingQueue</p>
<p>å¯¹äº<strong>æ¶ˆè´¹è€…</strong>å’Œ<strong>ç”Ÿäº§è€…</strong> é‡‡ç”¨ä¸åŒçš„é”æ¥æ§åˆ¶æ•°æ®åŒæ­¥ ç”Ÿäº§è€…ä¸åœçš„åœ¨é˜Ÿå°¾å¢åŠ å†…å®¹. æ¶ˆè´¹è€…ä¸åœçš„åœ¨é˜Ÿåˆ—å¤´éƒ¨ç”Ÿäº§å†…å®¹</p>
</li>
<li><p>PriorityBlockingQueue</p>
<p>é˜Ÿåˆ—ä½¿ç”¨å¤§æ ¹å †çš„æ–¹å¼è¿›è¡Œç»„ç»‡çš„. æ¯æ¬¡å–å †çš„æ ¹èŠ‚ç‚¹.æ¯æ¬¡æ·»åŠ å†…å®¹åä¼šè¿›è¡Œå †çš„rearrange.</p>
</li>
<li><p>DelayQueue</p>
<p>ä¹Ÿæ˜¯ç”¨å°æ ¹å †çš„æ–¹å¼è¿›è¡Œç»„ç»‡, ä»¥å»¶è¿Ÿçš„æ—¶é—´ä½œä¸ºæƒé‡å€¼, æ¯æ¬¡éƒ½ä»é˜Ÿåˆ—ä¸­å–å†…å®¹, ç„¶ådelayæŒ‡å®šçš„æ—¶é—´</p>
</li>
<li><p>SynchronousQueue</p>
<p>æ¯ä¸€ä¸ªputå¿…é¡»ç­‰å¾…ä¸€ä¸ªtakeæ“ä½œ.å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªæ•°æ®æš‚å­˜çš„åœ°æ–¹</p>
</li>
<li><p>LinkedTransferQueue</p>
<p>ç”±ä¸€ä¸ªé“¾è¡¨ç»„æˆçš„æ— ç•Œé˜»å¡TransferQueueé˜Ÿåˆ—.ç›¸å¯¹äºLinkedBlockingQueueå¤šäº†transfer()æ–¹æ³•</p>
</li>
</ul>
<h4 id="CountDownLunch"><a href="#CountDownLunch" class="headerlink" title="CountDownLunch"></a>CountDownLunch</h4><h4 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h4><h4 id="Semaphore-1"><a href="#Semaphore-1" class="headerlink" title="Semaphore"></a>Semaphore</h4><h3 id="Volatile"><a href="#Volatile" class="headerlink" title="Volatile"></a>Volatile</h3><p> åœ¨ JMMï¼ˆJava Memory Modelï¼‰æ•°æ®çš„æ‰§è¡Œä¸»è¦åˆ†ä¸º lockã€unlockã€readã€loadã€useã€assignã€storeã€writeã€‚ </p>
<blockquote>
<ul>
<li>readï¼ˆè¯»å–ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜å˜é‡ï¼ŒæŠŠä¸€ä¸ªå˜é‡å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„loadåŠ¨ä½œä½¿ç”¨</li>
<li>loadï¼ˆè½½å…¥ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠreadæ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ã€‚</li>
<li>useï¼ˆä½¿ç”¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼ŒæŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨å˜é‡çš„å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶å°†ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚</li>
<li>assignï¼ˆèµ‹å€¼ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹å€¼ç»™å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚</li>
<li>storeï¼ˆå­˜å‚¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼ŒæŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„writeçš„æ“ä½œã€‚</li>
<li>writeï¼ˆå†™å…¥ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜çš„å˜é‡ä¸­ã€‚</li>
</ul>
</blockquote>
<p> è¿™äº›è¡Œä¸ºæ˜¯ä¸å¯åˆ†è§£çš„åŸå­æ“ä½œï¼Œåœ¨ä½¿ç”¨ä¸Šç›¸äº’ä¾èµ–ï¼Œread-loadä»ä¸»å†…å­˜å¤åˆ¶å˜é‡åˆ°å½“å‰å·¥ä½œå†…å­˜ï¼Œuse-assignæ‰§è¡Œä»£ç æ”¹å˜å…±äº«å˜é‡å€¼ï¼Œstore-writeç”¨å·¥ä½œå†…å­˜æ•°æ®åˆ·æ–°ä¸»å­˜ç›¸å…³å†…å®¹ã€‚</p>
<p>è¦ä¿è¯æ‰€è°“çš„å¤šçº¿ç¨‹çš„æ•°æ®æ‰§è¡Œæ­£ç¡®ï¼Œå°±æ˜¯è¦ä¿è¯happen-beforeã€‚Aæ“ä½œå¦‚æœå‘ç”Ÿåœ¨Bæ“ä½œä¹‹å‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½ä¿è¯æ•°æ®çš„æ­£ç¡®ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å†…å­˜å±éšœçš„å¸®åŠ©ï¼Œ Javaå†…å­˜å±éšœä¸»è¦åˆ†ä¸ºå››ç§ï¼Œå®ƒä¿è¯åœ¨æ …æ å‰åˆå§‹åŒ–çš„loadå’ŒstoreæŒ‡ä»¤ï¼Œèƒ½å¤Ÿä¸¥æ ¼æœ‰åºçš„åœ¨æ …æ åçš„loadå’ŒstoreæŒ‡ä»¤ä¹‹å‰æ‰§è¡Œã€‚</p>
<ul>
<li><p>Load - Load</p>
<p>ç¡®ä¿Load1æ‰€è¦è¯»å…¥çš„æ•°æ®èƒ½å¤Ÿåœ¨è¢«Load2å’Œåç»­çš„loadæŒ‡ä»¤è®¿é—®å‰è¯»å…¥ã€‚</p>
</li>
<li><p>Store-Store</p>
<p>ç¡®ä¿Store1çš„æ•°æ®åœ¨Store2ä»¥åŠåç»­StoreæŒ‡ä»¤æ“ä½œç›¸å…³æ•°æ®ä¹‹å‰å¯¹å…¶å®ƒå¤„ç†å™¨å¯è§ï¼ˆä¾‹å¦‚å‘ä¸»å­˜åˆ·æ–°æ•°æ®ï¼‰</p>
</li>
<li><p>Load-Store</p>
<p>ç¡®ä¿Load1çš„æ•°æ®åœ¨Store2å’Œåç»­StoreæŒ‡ä»¤è¢«åˆ·æ–°ä¹‹å‰è¯»å–ã€‚</p>
</li>
<li><p>Store-Load</p>
<p><a target="_blank" rel="noopener" href="http://ifeve.com/jmm-cookbook-mb/">ifever</a></p>
<blockquote>
<p>ç¡®ä¿Store1çš„æ•°æ®åœ¨è¢«Load2å’Œåç»­çš„LoadæŒ‡ä»¤è¯»å–ä¹‹å‰å¯¹å…¶ä»–å¤„ç†å™¨å¯è§ã€‚StoreLoadå±éšœå¯ä»¥é˜²æ­¢ä¸€ä¸ªåç»­çš„loadæŒ‡ä»¤ ä¸æ­£ç¡®çš„ä½¿ç”¨äº†Store1çš„æ•°æ®ï¼Œè€Œä¸æ˜¯å¦ä¸€ä¸ªå¤„ç†å™¨åœ¨ç›¸åŒå†…å­˜ä½ç½®å†™å…¥ä¸€ä¸ªæ–°æ•°æ®ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œæ‰€ä»¥åœ¨ä¸‹é¢æ‰€è®¨è®ºçš„å¤„ç†å™¨ä¸ºäº†åœ¨å±éšœå‰è¯»å–åŒæ ·å†…å­˜ä½ç½®å­˜è¿‡çš„æ•°æ®ï¼Œå¿…é¡»ä½¿ç”¨ä¸€ä¸ªStoreLoadå±éšœå°†å­˜å‚¨æŒ‡ä»¤å’Œåç»­çš„åŠ è½½æŒ‡ä»¤åˆ†å¼€ã€‚Storeloadå±éšœåœ¨å‡ ä¹æ‰€æœ‰çš„ç°ä»£å¤šå¤„ç†å™¨ä¸­éƒ½éœ€è¦ä½¿ç”¨ï¼Œä½†é€šå¸¸å®ƒçš„å¼€é”€ä¹Ÿæ˜¯æœ€æ˜‚è´µçš„ã€‚å®ƒä»¬æ˜‚è´µçš„éƒ¨åˆ†åŸå› æ˜¯å®ƒä»¬å¿…é¡»å…³é—­é€šå¸¸çš„ç•¥è¿‡ç¼“å­˜ç›´æ¥ä»å†™ç¼“å†²åŒºè¯»å–æ•°æ®çš„æœºåˆ¶ã€‚è¿™å¯èƒ½é€šè¿‡è®©ä¸€ä¸ªç¼“å†²åŒºè¿›è¡Œå……åˆ†åˆ·æ–°ï¼ˆflushï¼‰,ä»¥åŠå…¶ä»–å»¶è¿Ÿçš„æ–¹å¼æ¥å®ç°ã€‚</p>
<p>åœ¨ä¸‹é¢è®¨è®ºçš„æ‰€æœ‰å¤„ç†å™¨ä¸­ï¼Œæ‰§è¡ŒStoreLoadçš„æŒ‡ä»¤ä¹Ÿä¼šåŒæ—¶è·å¾—å…¶ä»–ä¸‰ç§å±éšœçš„æ•ˆæœã€‚æ‰€ä»¥StoreLoadå¯ä»¥ä½œä¸ºæœ€é€šç”¨çš„ï¼ˆä½†é€šå¸¸ä¹Ÿæ˜¯æœ€è€—æ€§èƒ½ï¼‰çš„ä¸€ç§Fenceã€‚(è¿™æ˜¯ç»éªŒå¾—å‡ºçš„ç»“è®ºï¼Œå¹¶ä¸æ˜¯å¿…ç„¶)ã€‚åä¹‹ä¸æˆç«‹ï¼Œä¸ºäº†è¾¾åˆ°StoreLoadçš„æ•ˆæœè€Œç»„åˆä½¿ç”¨å…¶ä»–å±éšœå¹¶ä¸å¸¸è§ã€‚</p>
</blockquote>
</li>
</ul>
<h4 id="ThreadLocal-ä½œç”¨"><a href="#ThreadLocal-ä½œç”¨" class="headerlink" title="ThreadLocal ä½œç”¨"></a>ThreadLocal ä½œç”¨</h4><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/98b68c97df9b">ThreadLocalçš„è¯´æ˜1</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a1cd61fa22da">ThreadLocalçš„è¯´æ˜2</a></p>
<p>è¿™ä¸¤ç¯‡è¯´çš„å¾ˆæ¸…æ¥šäº†</p>
<p>æ¯ä¸ªThread å¯¹è±¡å†…éƒ¨éƒ½æœ‰ThreadMap&lt;Entity,  T&gt;ç±»å‹çš„å±æ€§ï¼Œå…¶ä¸­Entity extend WeakReference &lt; ThreadLocal&gt;çš„å®šä¹‰ä¸º.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span> <span class="keyword">extends</span> <span class="title">WeakReference</span>&lt;<span class="title">ThreadLocal</span>&lt;?&gt;&gt; </span>&#123;</span><br><span class="line">            <span class="comment">/** The value associated with this ThreadLocal. */</span></span><br><span class="line">            Object value;</span><br><span class="line"></span><br><span class="line">            Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line">                <span class="keyword">super</span>(k);</span><br><span class="line">                value = v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/964fbc30151a">WeakReferencesè¯´æ˜</a></p>
<p>WeakReferenceå¦‚å­—é¢æ„æ€ï¼Œå¼±å¼•ç”¨ï¼Œ å½“ä¸€ä¸ªå¯¹è±¡ä»…ä»…è¢«weak referenceï¼ˆå¼±å¼•ç”¨ï¼‰æŒ‡å‘ï¼Œè€Œæ²¡æœ‰ä»»ä½•å…¶ä»–strong referenceï¼ˆå¼ºå¼•ç”¨ï¼‰æŒ‡å‘çš„æ—¶å€™, å¦‚æœè¿™æ—¶GCè¿è¡Œ, é‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±ä¼šè¢«å›æ”¶ã€‚æˆ‘ä»¬å®šä¹‰äº†Entityï¼Œ å…¶ä¸­ThreadLocal æ˜¯å¼±å¼•ç”¨ï¼Œvalue æ˜¯å¼ºå¼•ç”¨ã€‚ Entityä¸­çš„ThreadLocalçš„å€¼èƒ½è¢«é¡ºåˆ©çš„GCï¼Œ ä½†æ˜¯valueä¸­çš„å€¼ä¸èƒ½å‘—é¡ºåˆ©çš„GCï¼Œ éœ€è¦æ‰‹åŠ¨çš„è®¾ç½®ï¼Œè®©JVM è®©å…¶GCã€‚</p>
<p>æ¯æ¬¡ThreadLocalçš„setå’Œgetæ–¹æ³•å®è´¨æ˜¯åœ¨ThreadMapä¸­æ”¾ç½®æˆ–è€…è¯»å–å€¼</p>
<p><strong>ThreadLocal å†…å­˜æ³„éœ²é—®é¢˜</strong></p>
<p>åœ¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dosomething</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  ThreadLocal&lt;String&gt; name = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line">  name.set(<span class="string">&quot;something&quot;</span>);</span><br><span class="line">  <span class="comment">// do something else </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆåœ¨ç»“æŸä¹‹åï¼Œ nameä¼šè¢«gcï¼Œ å› ä¸ºentityçš„å®šä¹‰ï¼Œ å…¶å¯¹è±¡ä¹Ÿä¼šè¢«å›æ”¶ï¼Œä½†æ˜¯ThreadLocalMap ä¸­çš„table[i] ä¸­è¿˜æ˜¯æ”¾ç€valueçš„å€¼ï¼Œå¯¼è‡´<strong>å†…å­˜æ³„æ¼</strong> æ¯”è¾ƒå»ºè®®çš„åšæ³•æ˜¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dosomething</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  ThreadLocal&lt;String&gt; name = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line"> 		name.set(<span class="string">&quot;something&quot;</span>);</span><br><span class="line">  	<span class="comment">// do something else </span></span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    name.remove();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ReetrantLockå’ŒSynchronized-ä¹‹é—´çš„åŒºåˆ«"><a href="#ReetrantLockå’ŒSynchronized-ä¹‹é—´çš„åŒºåˆ«" class="headerlink" title="ReetrantLockå’ŒSynchronized ä¹‹é—´çš„åŒºåˆ«"></a>ReetrantLockå’ŒSynchronized ä¹‹é—´çš„åŒºåˆ«</h3><ol>
<li>ReentrantLock æ˜¾ç¤ºçš„è·å¾—é”å’Œé‡Šæ”¾é”ï¼Œ Synchronizedéšå¼çš„è·å¾—é”</li>
<li>ReentrantLockå¯å“åº”ä¸­æ–­ï¼Œ Synchronizedä¸å¯ä»¥</li>
<li>ReetrantLock æ˜¯apiçº§åˆ« Sychronized æ˜¯JVM çº§åˆ«</li>
<li>ReetrantLock å¯ä»¥å®ç°å…¬å¹³é”</li>
<li>ReetrantLock é€šè¿‡conditionå¯ä»¥ç»‘å®šå¤šä¸ªæ¡ä»¶</li>
<li>synchronized æ˜¯åŒæ­¥é˜»å¡ï¼Œ lockæ˜¯åŒæ­¥éé˜»å¡</li>
<li>synchronizedå‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™ä¼šè‡ªåŠ¨é‡Šæ”¾é”ï¼Œè€ŒLockéœ€è¦åœ¨finallyä¸­è°ƒç”¨unlock()</li>
<li>é€šè¿‡Lockå¯ä»¥çŸ¥é“æ˜¯å¦è·å¾—é”ï¼Œè€ŒSynchronizedä¸å¯ä»¥</li>
</ol>
<h3 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h3><p>concurrentHashMapçš„æ•ˆç‡è¦æ¯”HashTableæ•ˆç‡é«˜çš„åŸå› æ˜¯ConcurrentHashMapé‡‡ç”¨äº†åˆ†ç‰‡çš„ç­–ç•¥ï¼Œé»˜è®¤åˆ†ä¸º16ç‰‡ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.andrewchen1.top/2019/08/11/Java-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%862/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="å°å¤«">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¤«çš„ç¬”è®°">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/11/Java-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%862/" class="post-title-link" itemprop="url">Java åŸºç¡€çŸ¥è¯†ç‚¹æ•´ç†2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-11 14:44:02" itemprop="dateCreated datePublished" datetime="2019-08-11T14:44:02+08:00">2019-08-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-30 22:05:10" itemprop="dateModified" datetime="2020-08-30T22:05:10+08:00">2020-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">JavaåŸºç¡€çŸ¥è¯†</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Java-é›†åˆ"><a href="#Java-é›†åˆ" class="headerlink" title="Java é›†åˆ"></a>Java é›†åˆ</h1><h2 id="é›†åˆæ¡†æ¶"><a href="#é›†åˆæ¡†æ¶" class="headerlink" title="é›†åˆæ¡†æ¶"></a>é›†åˆæ¡†æ¶</h2><h3 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h3><h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><ul>
<li><p>ArrayList</p>
<ol>
<li><p>æŒ‰ç…§æ’å…¥é¡ºåºæ’åº, å¯é‡å¤</p>
</li>
<li><p>åº•å±‚ä½¿ç”¨æ•°ç»„</p>
</li>
<li><p>å¯ä»¥éšæœºè¿›è¡Œè¯»å–ã€å¢åˆ æ…¢ (è¦æŒªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®)</p>
</li>
<li><p>çº¿ç¨‹ä¸å®‰å…¨</p>
</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wchicho/article/details/51987992">ConcurrentModificationExceptionåˆ†æ</a> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">list.add(<span class="number">1</span>);</span><br><span class="line">list.add(<span class="number">2</span>);</span><br><span class="line">list.add(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	* example 1</span></span><br><span class="line"><span class="comment">	* åœ¨è¿™ä¸ªæƒ…å†µä¸‹ä¸ä¼šæŠ›é”™</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">  <span class="keyword">int</span> length = list.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (list.get(i).equals(<span class="number">2</span>)) &#123;</span><br><span class="line">                list.add(<span class="number">10</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">		* example 2</span></span><br><span class="line"><span class="comment">		* åœ¨è¿™ç§æƒ…å†µä¸‹ä¼šæŠ›é”™</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> temp : list) &#123;</span><br><span class="line">    <span class="keyword">if</span>(temp == <span class="number">2</span>) &#123;</span><br><span class="line">      list.add(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * exmple 3</span></span><br><span class="line"><span class="comment"> * åœ¨è¿™ç§æƒ…å†µä¸‹ä¼šæŠ›é”™</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Iterator&lt;Integer&gt; iterator = list.iterator();</span><br><span class="line"><span class="keyword">while</span>(iterator.hasNext()) &#123;</span><br><span class="line">  <span class="keyword">if</span>(iterator.next().equals(<span class="number">2</span>)) &#123;</span><br><span class="line">    list.add(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * example 4</span></span><br><span class="line"><span class="comment"> * åœ¨è¿™ç§æƒ…å†µä¸‹ä¸ä¼šæŠ›é”™</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ListIterator&lt;Integer&gt; listIterator = list.listIterator();</span><br><span class="line"><span class="keyword">while</span> (listIterator.hasNext()) &#123;</span><br><span class="line">  <span class="keyword">if</span> (listIterator.next().equals(<span class="number">2</span>)) &#123;</span><br><span class="line">    listIterator.add(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¼šæŠ›å‡ºé”™è¯¯çš„åŸå› </p>
<p>åœ¨ArrayList å†…æœ‰ä¸ªå†…éƒ¨ç±»Itr</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Itr</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é¢„æœŸä¿®æ”¹(modification)æ¬¡æ•°</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">int</span> expectedModCount = modCount;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿­ä»£å™¨è°ƒç”¨next æ–¹æ³•çš„æ—¶å€™ä¼šæ£€æŸ¥å½“å‰ç±»çš„ä¿®æ”¹æ¬¡æ•°å’Œè¿­ä»£å™¨å†…çš„ä¿®æ”¹æ¬¡æ•°æ˜¯ä¸æ˜¯ä¸€è‡´, å¦‚æœæ˜¯ä¸ä¸€è‡´çš„è¯ å°±çˆ†ç‚¸.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	checkForComodification();</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">int</span> i = cursor;</span><br><span class="line">		E next = get(i);</span><br><span class="line">		lastRet = i;</span><br><span class="line">		cursor = i + <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">return</span> next;</span><br><span class="line">	&#125; <span class="keyword">catch</span>(IndexOutOfBoundsException e) &#123;</span><br><span class="line">		checkForComodification();</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">	checkForComodification();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">int</span> i = cursor;</span><br><span class="line">		ArrayList.<span class="keyword">this</span>.add(i, e);</span><br><span class="line">		cursor = i + <span class="number">1</span>;</span><br><span class="line">		lastRet = -<span class="number">1</span>;</span><br><span class="line">		exceptedModCount = modCount;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IndexOutOfBoundException ex) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ¡ˆä¾‹1 ä¸­æ²¡æœ‰ä½¿ç”¨åˆ°è¿­ä»£å™¨ç›¸å…³çš„api</p>
<p>åœ¨æ¡ˆä¾‹ 2, 3 ä¸­ä½¿ç”¨äº†è¿­ä»£å™¨ç›¸å…³çš„api åœ¨å¤–éƒ¨ç±»çš„mod time å‘ç”Ÿäº†æ”¹å˜çš„æ—¶å€™æ²¡æœ‰å¯¹è¿­ä»£å™¨å†…éƒ¨çš„mod time åŒæ—¶è¿›è¡Œä¿®æ­£, å½“å†æ¬¡è°ƒç”¨next çš„æ—¶å€™å‘ç°å†…éƒ¨ç±»è®°å½•çš„ä¿®æ”¹æ¬¡æ•°å’Œç±»å¤–éƒ¨çš„ä¿®æ”¹æ¬¡æ•°ä¸ä¸€æ ·.çˆ†ç‚¸.</p>
</li>
<li><p>Vector</p>
<ol>
<li>æŒ‰ç…§æ’å…¥é¡ºåºæ’åº å¯é‡å¤</li>
<li>åº•å±‚ä½¿ç”¨æ•°ç»„</li>
<li>å¯ä»¥éšæœºè¯»å– å¢åˆ æ…¢(è¦æŒªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®)</li>
<li>çº¿ç¨‹å®‰å…¨</li>
</ol>
</li>
<li><p>LinkedList</p>
<ol>
<li>æŒ‰ç…§æ’å…¥é¡ºåºæ’åº å…ƒç´ å¯é‡å¤</li>
<li>é€šè¿‡é“¾è¡¨çš„æ–¹å¼ä¿å­˜æ•°æ®</li>
<li>ä¸å¯ä»¥éšæœºè¯»å–æ•°æ® è¦é€šè¿‡å¤´èŠ‚ç‚¹ æˆ–è€…å°¾èŠ‚ç‚¹ ä»¥éå†çš„æ–¹å¼è·å¾—æ‰€å¾—çš„å…ƒç´  ä½†æ˜¯ add å’Œremoveçš„æ–¹æ³•å¿«</li>
</ol>
</li>
</ul>
<h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h4><ul>
<li><p>HashSet</p>
<p>æ’åˆ—æ— åº ä¸å¯é‡å¤ åº•å±‚æ˜¯HashMap. </p>
</li>
<li><p>TreeSet</p>
<p>å†…éƒ¨æ˜¯TreeMapçš„sortedSet</p>
</li>
<li><p>LinkedHashSet</p>
<p>å†…éƒ¨æ˜¯LinkedHashMap</p>
</li>
</ul>
<h4 id="Queued"><a href="#Queued" class="headerlink" title="Queued"></a>Queued</h4><ul>
<li>PriorityQueued</li>
</ul>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><ul>
<li><p>HashMap</p>
<p>keyä¸å¯é‡å¤ value å¯ä»¥é‡å¤</p>
<p>åº•å±‚hashè¡¨</p>
<p>çº¿ç¨‹ä¸å®‰å…¨ (å¯èƒ½ä¼šé€ æˆendless loop)</p>
<p>å…è®¸keyå€¼ä¸ºnull</p>
</li>
<li><p>HashTable</p>
<p>keyä¸å¯é‡å¤</p>
<p>åº•å±‚hashtable</p>
<p>çº¿ç¨‹å®‰å…¨</p>
<p>key value éƒ½ä¸å…è®¸ä¸ºnull</p>
</li>
<li><p>TreeMap</p>
<p>keyä¸å¯ä»¥é‡å¤</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.andrewchen1.top/2019/08/10/mybatis-chapter2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="å°å¤«">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¤«çš„ç¬”è®°">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/10/mybatis-chapter2/" class="post-title-link" itemprop="url">mybatis chapter2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-10 17:06:12" itemprop="dateCreated datePublished" datetime="2019-08-10T17:06:12+08:00">2019-08-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-08-11 13:56:05" itemprop="dateModified" datetime="2019-08-11T13:56:05+08:00">2019-08-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MyBatis%E5%86%85%E5%B9%95/" itemprop="url" rel="index"><span itemprop="name">MyBatiså†…å¹•</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="åŸºç¡€æ”¯æŒå±‚"><a href="#åŸºç¡€æ”¯æŒå±‚" class="headerlink" title="åŸºç¡€æ”¯æŒå±‚"></a>åŸºç¡€æ”¯æŒå±‚</h1><h2 id="è§£æå™¨æ¨¡å—"><a href="#è§£æå™¨æ¨¡å—" class="headerlink" title="è§£æå™¨æ¨¡å—"></a>è§£æå™¨æ¨¡å—</h2><ul>
<li>Dom</li>
<li>SAX</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.andrewchen1.top/2019/08/10/mybatis-chapter1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="å°å¤«">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¤«çš„ç¬”è®°">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/10/mybatis-chapter1/" class="post-title-link" itemprop="url">mybatis chapter1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-10 15:56:45" itemprop="dateCreated datePublished" datetime="2019-08-10T15:56:45+08:00">2019-08-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-08-11 13:57:06" itemprop="dateModified" datetime="2019-08-11T13:57:06+08:00">2019-08-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MyBatis%E5%86%85%E5%B9%95/" itemprop="url" rel="index"><span itemprop="name">MyBatiså†…å¹•</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MyBatis-å¿«é€Ÿå…¥é—¨"><a href="#MyBatis-å¿«é€Ÿå…¥é—¨" class="headerlink" title="MyBatis å¿«é€Ÿå…¥é—¨"></a>MyBatis å¿«é€Ÿå…¥é—¨</h1><h2 id="Mybatisç¤ºä¾‹"><a href="#Mybatisç¤ºä¾‹" class="headerlink" title="Mybatisç¤ºä¾‹"></a>Mybatisç¤ºä¾‹</h2><p>é…ç½®æ–‡ä»¶</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="meta">    &lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;/&gt;</span></span><br><span class="line"><span class="meta">    &lt;configuration&gt;</span></span><br><span class="line"><span class="meta">        &lt;properites&gt;</span></span><br><span class="line"><span class="meta">            &lt;property name = &quot;username&quot; value =&quot;root&quot;/&gt;</span></span><br><span class="line"><span class="meta">            &lt;property name = &quot;id&quot; value = &quot;123&quot;/&gt;</span></span><br><span class="line"><span class="meta">        &lt;/properites&gt;</span></span><br><span class="line"><span class="meta">        &lt;settings&gt;</span></span><br><span class="line"><span class="meta">            &lt;setting name=&quot;cacheEnabled&quot; value = &quot;true&quot;/&gt;</span></span><br><span class="line"><span class="meta">        &lt;/settings&gt;</span></span><br><span class="line"><span class="meta">        &lt;typeAliases&gt;</span></span><br><span class="line"><span class="meta">            &lt;typeAlias type = &quot;com.xxx.Blog&quot; alias = &quot;Blog&quot;/&gt;</span></span><br><span class="line"><span class="meta">        &lt;/typeAliases&gt;</span></span><br><span class="line"><span class="meta">        &lt;enviroments default = &quot;development&quot;&gt;</span></span><br><span class="line"><span class="meta">            &lt;enviroment id = &quot;development&quot;&gt;</span></span><br><span class="line"><span class="meta">                &lt;transcationManager type=&quot;JDBC&quot;/&gt;</span></span><br><span class="line"><span class="meta">                &lt;dataSource type=&quot;POOLED&quot;&gt;</span></span><br><span class="line"><span class="meta">                    &lt;property name=&quot;driver&quot; value = &quot;com.mysql.jdbc.Driver&quot;/&gt;</span></span><br><span class="line"><span class="meta">                    &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/test&quot;/&gt;</span></span><br><span class="line"><span class="meta">                    &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span></span><br><span class="line"><span class="meta">                    &lt;property name=&quot;password&quot; value=&quot;&quot;/&gt;</span></span><br><span class="line"><span class="meta">                &lt;/dataSource&gt;</span></span><br><span class="line"><span class="meta">            &lt;/enviroment&gt;</span></span><br><span class="line"><span class="meta">        &lt;/enviroments&gt;</span></span><br><span class="line"><span class="meta">        &lt;mappers&gt;</span></span><br><span class="line"><span class="meta">            &lt;mapper resource=&quot;com/***/BlogMapper.xml&quot;/&gt;</span></span><br><span class="line"><span class="meta">        &lt;/mappers&gt;            </span></span><br><span class="line"><span class="meta">    &lt;/configuration&gt;</span></span><br><span class="line"><span class="meta">&lt;/xml&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œçš„javaä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String resource = <span class="string">&quot;com/xxx/mybatis-config.xml&quot;</span>;</span><br><span class="line">        InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuillder().build(inputStream);</span><br><span class="line"></span><br><span class="line">        SqlSession sqlsession = sqlSessionFactory.openSession();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Map&lt;String,Object&gt; parameter = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            parameter.put(<span class="string">&quot;id&quot;</span>, <span class="number">1</span>);</span><br><span class="line">            Blog blog = sqlSession.selectOne(<span class="string">&quot;com.xxx.BlogMapper.selectBlogDetails&quot;</span>, parameter);</span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="MyBatis-æ•´ä½“æ¶æ„"><a href="#MyBatis-æ•´ä½“æ¶æ„" class="headerlink" title="MyBatis æ•´ä½“æ¶æ„"></a>MyBatis æ•´ä½“æ¶æ„</h2><h3 id="åŸºç¡€æ”¯æŒå±‚"><a href="#åŸºç¡€æ”¯æŒå±‚" class="headerlink" title="åŸºç¡€æ”¯æŒå±‚"></a>åŸºç¡€æ”¯æŒå±‚</h3><ul>
<li><p>åå°„æ¨¡å—</p>
</li>
<li><p>ç±»å‹è½¬æ¢æ¨¡å—</p>
<p>jdbcTypeå’ŒJavaTypeä¹‹é—´ç±»å‹åšè½¬æ¢</p>
</li>
<li><p>æ—¥å¿—æ¨¡å—</p>
</li>
<li><p>èµ„æºåŠ è½½æ¨¡å—</p>
<p>å¯¹ç±»åŠ è½½å™¨è¿›è¡Œå°è£…</p>
</li>
<li><p>è§£æå™¨æ¨¡å—</p>
<p>å¯¹Xpathè¿›è¡Œå°è£… ä¸ºconfigå¤„ç†æä¾›æ”¯æŒ </p>
<p>ä¸ºå¤„ç†sqlè¯­è¨€ä¸­çš„å ä½ç¬¦æä¾›æ”¯æŒ</p>
</li>
<li><p>æ•°æ®æºæ¨¡å—</p>
</li>
<li><p>äº‹åŠ¡ç®¡ç†</p>
</li>
<li><p>ç¼“å­˜æ¨¡å—</p>
</li>
<li><p>Bindingæ¨¡å—</p>
</li>
</ul>
<h3 id="æ ¸å¿ƒå¤„ç†å±‚"><a href="#æ ¸å¿ƒå¤„ç†å±‚" class="headerlink" title="æ ¸å¿ƒå¤„ç†å±‚"></a>æ ¸å¿ƒå¤„ç†å±‚</h3><ul>
<li><p>é…ç½®è§£æ</p>
</li>
<li><p>Sqlè§£æä¸sripting æ¨¡å—</p>
</li>
<li><p>Sqlæ‰§è¡Œ</p>
<p>sqlSession -&gt; executor -&gt; statementHandler -&gt; parameterHandler -&gt; statement -&gt; db -&gt; resultSet -&gt;ResultSetHandler -&gt; StatementHandler -&gt;executor -&gt; sqlSession </p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.andrewchen1.top/2019/08/03/Java-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%861/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="å°å¤«">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¤«çš„ç¬”è®°">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/03/Java-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%861/" class="post-title-link" itemprop="url">Java åŸºç¡€çŸ¥è¯†ç‚¹æ•´ç†1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-03 15:15:09" itemprop="dateCreated datePublished" datetime="2019-08-03T15:15:09+08:00">2019-08-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-30 22:05:20" itemprop="dateModified" datetime="2020-08-30T22:05:20+08:00">2020-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">JavaåŸºç¡€çŸ¥è¯†</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="http://img.andrewchen1.top/JavaçŸ¥è¯†ç‚¹æ•´ç†.pdf">JavaåŸºç¡€çŸ¥è¯†ç‚¹æ•´ç†</a></p>
<h2 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h2><h3 id="JVM-åå°è¿è¡Œçš„ç³»ç»Ÿè¿›ç¨‹"><a href="#JVM-åå°è¿è¡Œçš„ç³»ç»Ÿè¿›ç¨‹" class="headerlink" title="JVM åå°è¿è¡Œçš„ç³»ç»Ÿè¿›ç¨‹"></a>JVM åå°è¿è¡Œçš„ç³»ç»Ÿè¿›ç¨‹</h3><ul>
<li><p>è™šæ‹Ÿæœºçº¿ç¨‹</p>
<p>è¿™ä¸ªçº¿ç¨‹ç­‰å¾…JVMåˆ°è¾¾å®‰å…¨ç‚¹æ“ä½œå‡ºç°. Stop the world åƒåœ¾å›æ”¶ã€çº¿ç¨‹æ ˆdumpã€çº¿ç¨‹æš‚åœã€çº¿ç¨‹åå‘é”è§£é™¤.</p>
</li>
<li><p>å‘¨æœŸæ€§ä»»åŠ¡çº¿ç¨‹</p>
<p>è¿™çº¿ç¨‹è´Ÿè´£å®šæ—¶å™¨äº‹ä»¶(ä¸­æ®µ),ç”¨æ¥è°ƒåº¦å‘¨æœŸæ€§æ“ä½œçš„æ‰§è¡Œ</p>
</li>
<li><p>GCçº¿ç¨‹</p>
<p>ä¸åŒçš„GC</p>
</li>
<li><p>ç¼–è¯‘å™¨çº¿ç¨‹</p>
<p>å°†å­—èŠ‚ç ç¼–è¯‘æˆæœ¬åœ°ç </p>
</li>
<li><p>ä¿¡å·åˆ†å‘çº¿ç¨‹</p>
<p>è¿™ä¸ªçº¿ç¨‹å‘é€åˆ°JVMçš„ä¿¡å·å¹¶è°ƒç”¨é€‚å½“çš„JVMæ–¹æ³•å¤„ç†.</p>
</li>
</ul>
<h3 id="JVM-å†…å­˜åŒºåŸŸ"><a href="#JVM-å†…å­˜åŒºåŸŸ" class="headerlink" title="JVM å†…å­˜åŒºåŸŸ"></a>JVM å†…å­˜åŒºåŸŸ</h3><ol>
<li><p>çº¿ç¨‹ç§æœ‰åŒºåŸŸ</p>
<ol>
<li><p>ç¨‹åºè®¡æ•°å™¨</p>
<p>è®¡æ•°å™¨è®°å½•çš„æ˜¯è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€(<strong>å½“å‰çš„åœ°å€</strong>)</p>
</li>
<li><p>è™šæ‹Ÿæœº æ ˆ <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/45354152">çŸ¥ä¹ä»‹ç»</a></p>
<ol>
<li><p>å±€éƒ¨å˜é‡è¡¨ é‡Œé¢ä¼šåŒ…æ‹¬ è¿™ä¸ªæ–¹æ³•çš„ä¸´æ—¶å˜é‡å’Œå…¥å‚æ•°ä¿¡æ¯</p>
</li>
<li><p>æ“ä½œæ•°æ ˆ <a target="_blank" rel="noopener" href="https://codeday.me/bug/20171209/105524.html">æ“ä½œæ•°æ ˆ</a></p>
<blockquote>
<p>å½“ä¸€ä¸ªæ–¹æ³•åˆšåˆšå¼€å§‹æ‰§è¡Œæ—¶ï¼Œå…¶æ“ä½œæ•°æ ˆæ˜¯ç©ºçš„ï¼Œéšç€æ–¹æ³•æ‰§è¡Œå’Œå­—èŠ‚ç æŒ‡ä»¤çš„æ‰§è¡Œï¼Œä¼šä»å±€éƒ¨å˜é‡è¡¨æˆ–å¯¹è±¡å®ä¾‹çš„å­—æ®µä¸­å¤åˆ¶å¸¸é‡æˆ–å˜é‡å†™å…¥åˆ°æ“ä½œæ•°æ ˆï¼Œ</p>
<p>å†éšç€è®¡ç®—çš„è¿›è¡Œå°†æ ˆä¸­å…ƒç´ å‡ºæ ˆåˆ°å±€éƒ¨å˜é‡è¡¨æˆ–è€…è¿”å›ç»™æ–¹æ³•è°ƒç”¨è€…ï¼Œä¹Ÿå°±æ˜¯å‡ºæ ˆ/å…¥æ ˆæ“ä½œ</p>
</blockquote>
<p>æ¯”æ–¹è¯´ int result = parameter1 + parameter2</p>
<p>å®é™…ä¸Šå°±æ˜¯iadd, å®ƒå°†ä¸¤ä¸ªintæ·»åŠ åœ¨ä¸€èµ·.è¦ä½¿ç”¨å®ƒï¼Œä½ åœ¨å †æ ˆä¸Šæ¨ä¸¤ä¸ªå€¼ï¼Œç„¶åä½¿ç”¨å®ƒ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iload_0     # Push the value from local variable 0 onto the stack</span><br><span class="line">iload_1     # Push the value from local variable 1 onto the stack</span><br><span class="line">iadd        # Pops those off the stack, adds them, and pushes the result</span><br></pre></td></tr></table></figure>

<p>æ¯”æ–¹è¯´ int result = parameter1 + parameter2 + parameter3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iload_0     # Push the value from local variable 0 onto the stack</span><br><span class="line">iload_1     # Push the value from local variable 1 onto the stack</span><br><span class="line">iadd        # Pops those off the stack, adds them, and pushes the result</span><br><span class="line">iload_2     # Push the value from local variable 2 onto the stack</span><br><span class="line">iadd        # Pops those off the stack, adds them, and pushes the result</span><br></pre></td></tr></table></figure>
</li>
<li><p>åŠ¨æ€é“¾æ¥</p>
<blockquote>
<p>Javaè™šæ‹Ÿæœºæ ˆä¸­ï¼Œæ¯ä¸ªæ ˆå¸§éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è¯¥æ ˆæ‰€å±æ–¹æ³•çš„ç¬¦å·å¼•ç”¨.è¿™äº›ç¬¦å·å¼•ç”¨ä¸€éƒ¨åˆ†ä¼šåœ¨ç±»åŠ è½½é˜¶æ®µæˆ–è€…ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶å°±ç›´æ¥è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ï¼Œè¿™ç±»è½¬åŒ–ç§°ä¸º<strong>é™æ€è§£æ</strong>ã€‚å¦ä¸€éƒ¨åˆ†å°†åœ¨æ¯æ¬¡è¿è¡ŒæœŸé—´è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ï¼Œè¿™ç±»è½¬åŒ–ç§°ä¸ºåŠ¨æ€è¿æ¥ã€‚</p>
</blockquote>
</li>
<li><p>æ–¹æ³•è¿”å›</p>
<blockquote>
<p>ä¸€ä¸ªæ–¹æ³•å¯èƒ½æœ‰ä¸¤ç§æ–¹æ³•é€€å‡º æ­£å¸¸è¿”å›å’Œå‡ºç°å¼‚å¸¸è¿”å›.ä¸€èˆ¬æ¥è¯´ï¼Œæ–¹æ³•æ­£å¸¸é€€å‡ºæ—¶ï¼Œè°ƒç”¨è€…çš„PCè®¡æ•°å€¼å¯ä»¥ä½œä¸ºè¿”å›åœ°å€ï¼Œæ ˆå¸§ä¸­å¯èƒ½ä¿å­˜æ­¤è®¡æ•°å€¼ã€‚è€Œæ–¹æ³•å¼‚å¸¸é€€å‡ºæ—¶ï¼Œè¿”å›åœ°å€æ˜¯é€šè¿‡å¼‚å¸¸å¤„ç†å™¨è¡¨ç¡®å®šçš„ï¼Œæ ˆå¸§ä¸­ä¸€èˆ¬ä¸ä¼šä¿å­˜æ­¤éƒ¨åˆ†ä¿¡æ¯ã€‚</p>
</blockquote>
</li>
</ol>
</li>
<li><p>æœ¬åœ°æ–¹æ³•åŒº</p>
<blockquote>
<p>æ–¹æ³•è¿”å›æ—¶å¯èƒ½éœ€è¦åœ¨å½“å‰æ ˆå¸§ä¸­ä¿å­˜ä¸€äº›ä¿¡æ¯ï¼Œç”¨æ¥å¸®ä»–æ¢å¤å®ƒçš„ä¸Šå±‚æ–¹æ³•æ‰§è¡ŒçŠ¶æ€ã€‚</p>
</blockquote>
</li>
</ol>
</li>
<li><p>çº¿ç¨‹å…±äº«åŒº</p>
<ol>
<li><p>Javaå †</p>
<p>ä»GCçš„è§’åº¦æ¥è¯´å¯ä»¥åˆ†ä¸º æ–°ç”Ÿä»£ã€è€å¹´ä»£</p>
<p>æ–°ç”Ÿä»£</p>
<p>æ–°ç”Ÿä»£å ç”¨å †åŒº1/3ç©ºé—´. æ–°ç”Ÿä»£åˆ†ä¸º Edenã€ServivorFromã€ServivorTo ä¸‰ä¸ªåŒºåŸŸ.åˆ†é…çš„æ¯”ä¾‹æ˜¯ 8:1:1.åœ¨æ–°ç”Ÿä»£å‘ç”Ÿçš„åƒåœ¾è¢«ç§°ä¸º</p>
<p>è€å¹´ä»£</p>
<p>è€å¹´ä»£çš„æ•°æ®æ¯”è¾ƒçš„ç¨³å®š,æ‰€ä»¥MajorGC ä¸ä¼šå¹³å‡¡çš„å‘ç”Ÿ ç„¶åä½¿ç”¨çš„ç®—æ³•æ˜¯æ ‡è®°-æ¸…é™¤ç®—æ³•. åœ¨è§¦å‘Major Gcä¹‹å‰ä¸€å®šä¼šè§¦å‘ä¸€æ¬¡MinorGC</p>
<p>åƒåœ¾å›æ”¶ç®—æ³•</p>
<ul>
<li><p>æ ‡è®°-æ¸…é™¤</p>
<p>â€‹    æ²¡æœ‰è¿ç»­çš„å¯ç”¨çš„å†…å­˜ç©ºé—´,ä¼šæœ‰å¾ˆå¤šçš„ç¢ç‰‡.</p>
</li>
<li><p>å¤åˆ¶ç®—æ³•</p>
<p>å°†å†…å­˜åˆ†ä¸ºåŒç­‰å¤§å°çš„ä¸¤å—.å½“æŸä¸€å—å†…å­˜æ»¡åå°†å°šå­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šå».å¯¹è±¡çš„Ageä¼š+1.é»˜è®¤å¹´é¾„åˆ°è¾¾15ä¼šç§»åŠ¨åˆ°è€å¹´åŒº.</p>
</li>
<li><p>æ ‡è®°æ•´ç†ç®—æ³•</p>
<p>æ ‡è®°é˜¶æ®µå’ŒMark-Sweepç®—æ³•ç›¸åŒ,æ ‡è®°åä¸æ˜¯æ¸…ç†å¯¹è±¡,è€Œæ˜¯å°†å­˜æ´»å¯¹è±¡ç§»å‘å†…å­˜çš„ä¸€ç«¯.</p>
</li>
</ul>
</li>
<li><p>æ–¹æ³•åŒº</p>
<p>ä¸»è¦å­˜æ”¾ç±»ä¿¡æ¯å’Œmeta-data. åœ¨Java8ä¸­æ°¸ä¹…å¸¦å·²ç»è¢«å…ƒç©ºé—´çš„æ¦‚å¿µå–ä»£.å…ƒç©ºé—´ä¸å­˜åœ¨è™šæ‹Ÿæœºä¸­,è€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜.åœ¨é»˜è®¤æƒ…å†µä¸‹å…ƒç©ºé—´çš„å¤§å°ä»…å—æœ¬åœ°å†…å­˜é™åˆ¶.</p>
</li>
</ol>
</li>
<li><p>Javaçš„å››ç§å¼•ç”¨ç±»å‹</p>
<ol>
<li><p>å¼ºå¼•ç”¨</p>
<p>æœ€å¸¸è§çš„å°±æ˜¯å¼ºå¼•ç”¨.å½“ä¸€ä¸ªå¯¹è±¡(Object)ä¿¡æ¯è¢«èµ‹å€¼ç»™ä¸€ä¸ªå¼•ç”¨(Reference)æ—¶,å°±æ˜¯å¼ºå¼•ç”¨.å½“å¤„äºå¯è¾¾çŠ¶æ€æ—¶ä¸å¯èƒ½è¢«å›æ”¶çš„ </p>
</li>
<li><p>è½¯å¼•ç”¨</p>
<p>SoftReference.å½“å†…å­˜ä¸å¤Ÿæ—¶å€™ä¼šè¢«å›æ”¶</p>
</li>
<li><p>å¼±å¼•ç”¨</p>
<p>WeakReference å½“åƒåœ¾å›æ”¶æœºåˆ¶ä¸€è¿è¡Œæ€»ä¼šå›æ”¶è¯¥å¯¹è±¡å æœ‰çš„å†…å­˜. å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªThreadLoadçš„å€¼çš„æ—¶å€™,å®é™…ä¸Šæ˜¯åŠ å…¥åˆ°ThreadLocalMap&lt;WeakReference&lt;ThreadLocal&lt;?&gt;&gt;,  Object&gt; ä¸­</p>
</li>
<li><p>è™šå¼•ç”¨</p>
<p>éœ€è¦PhantomReference ç±»å®ç°,å®ƒä¸èƒ½å•ç‹¬ä½¿ç”¨, å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—è”åˆä½¿ç”¨.è™šå¼•ç”¨çš„ä¸»è¦ä½œç”¨æ˜¯è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„çŠ¶æ€.</p>
</li>
</ol>
</li>
<li><p>åƒåœ¾å›æ”¶ç®—å™¨</p>
<p>é’ˆå¯¹ä¸åŒçš„å†…å­˜åŒºåŸŸé‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—å™¨. </p>
<ul>
<li>å¹´è½»å¸¦:</li>
</ul>
<p>â€‹    Serial å•çº¿ç¨‹çš„åƒåœ¾æ”¶é›†å™¨. STW. <strong>å¤åˆ¶</strong></p>
<p>â€‹    ParNew Serialçš„å¤šçº¿ç¨‹ç‰ˆæœ¬.STW. <strong>å¤åˆ¶</strong></p>
<p>â€‹    Parallel scavenge å¤šçº¿ç¨‹çš„åƒåœ¾æ”¶é›†å™¨. é€šè¿‡è‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥æ¥è¾¾åˆ°æœ€å¤§çš„ååé‡. STW. <strong>å¤åˆ¶</strong> </p>
<ul>
<li>å¹´è€å¸¦:</li>
</ul>
<p>â€‹    Serial Old æ˜¯Serialè€å¹´åŒºç‰ˆæœ¬ å•çº¿ç¨‹ STW.  <strong>æ ‡è®°æ•´ç†</strong></p>
<p>â€‹    Parallel Old æ˜¯Parallel scagengeè€å¹´åŒºç‰ˆæœ¬ STW <strong>æ ‡è®°æ•´ç†</strong></p>
<ul>
<li><p>CMS</p>
<p>åˆå§‹æ ‡è®° (åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½å¤Ÿç›´æ¥å…³è”çš„å¯¹è±¡ STW)</p>
<p>å¹¶å‘æ ‡è®° </p>
<p>é‡æ–°æ ‡è®°</p>
<p>å¹¶å‘æ¸…é™¤(å’Œç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œ ä¸éœ€è¦æš‚åœå·¥ä½œçº¿ç¨‹)</p>
</li>
<li><p>G1</p>
<p>åŸºäºæ ‡è®°-æ•´ç†ç®—æ³• ä¸äº§ç”Ÿå†…å­˜ç¢ç‰‡</p>
<p>éå¸¸å‡†ç¡®æ§åˆ¶åœé¡¿æ—¶é—´,åœ¨ä¸ç‰ºç‰²ååé‡å‰æä¸‹å®ç°ä½åœé¡¿åƒåœ¾å›æ”¶</p>
</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.andrewchen1.top/2019/05/09/spring-boot-in-action-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="å°å¤«">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¤«çš„ç¬”è®°">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/09/spring-boot-in-action-1/" class="post-title-link" itemprop="url">spring boot in action 1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-05-09 19:52:59" itemprop="dateCreated datePublished" datetime="2019-05-09T19:52:59+08:00">2019-05-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-30 22:14:54" itemprop="dateModified" datetime="2020-08-30T22:14:54+08:00">2020-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring-boot-in-action/" itemprop="url" rel="index"><span itemprop="name">spring boot in action</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="é‡æ–°è®¤è¯†spring"><a href="#é‡æ–°è®¤è¯†spring" class="headerlink" title="é‡æ–°è®¤è¯†spring"></a>é‡æ–°è®¤è¯†spring</h2><h3 id="åŸºäºservlet-çš„webå¼€å‘"><a href="#åŸºäºservlet-çš„webå¼€å‘" class="headerlink" title="åŸºäºservlet çš„webå¼€å‘"></a>åŸºäºservlet çš„webå¼€å‘</h3><p>é¦–å…ˆæˆ‘ä»¬ä¼šå®šä¹‰</p>
<p>å¦‚æœå¼€å‘ä¸€ä¸ªç®€å•çš„ hello world webåº”ç”¨</p>
<ul>
<li><p>ä¸€ä¸ªé¡¹ç›®ç»“æ„</p>
</li>
<li><p>ä¸€ä¸ªweb.xml æ–‡ä»¶ æˆ–è€…WebApplicationInitializerå®ç°.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">id</span>=<span class="string">&quot;WebApp_ID&quot;</span> <span class="attr">version</span>=<span class="string">&quot;2.4&quot;</span><span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee&quot;</span><span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2eehttp://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/applicationContext.xml,/WEB-INF/controllers.xml,/WEB-INF/service.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatch<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatch<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-pattern</span>&gt;</span>*.*<span class="tag">&lt;/<span class="name">servlet-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.andrewchen1.top/2019/04/07/AKKA-IN-ACTION-1-%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="å°å¤«">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¤«çš„ç¬”è®°">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/07/AKKA-IN-ACTION-1-%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">AKKA_IN_ACTION 1 ç®€ä»‹</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-07 15:54:46" itemprop="dateCreated datePublished" datetime="2019-04-07T15:54:46+08:00">2019-04-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-30 22:15:32" itemprop="dateModified" datetime="2020-08-30T22:15:32+08:00">2020-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Akka-in-action/" itemprop="url" rel="index"><span itemprop="name">Akka in action</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="å“åº”å¼ç¼–ç¨‹"><a href="#å“åº”å¼ç¼–ç¨‹" class="headerlink" title="å“åº”å¼ç¼–ç¨‹"></a>å“åº”å¼ç¼–ç¨‹</h2><ul>
<li>I/O é˜»å¡é™åˆ¶äº†å¹¶è¡Œæ€§</li>
<li>åŒæ­¥äº¤äº’é™åˆ¶äº†å¹¶è¡Œæ€§</li>
<li>è½®è¯¢å‡å°‘äº†ä½¿ç”¨æ›´å°‘èµ„æºçš„æœºä¼š</li>
<li>ä¸€ä¸ªèŠ‚ç‚¹ä¼šæ‹–æ…¢æ‰€æœ‰çš„å…¶ä»–çš„èŠ‚ç‚¹ éœ€è¦éš”ç¦»é”™è¯¯</li>
<li>ç³»ç»Ÿçš„éƒ¨ç½²èƒ½å¤Ÿå¼¹æ€§</li>
</ul>
<h2 id="å»ºç«‹å®ä¾‹"><a href="#å»ºç«‹å®ä¾‹" class="headerlink" title="å»ºç«‹å®ä¾‹"></a>å»ºç«‹å®ä¾‹</h2><table>
<thead>
<tr>
<th>ç›®æ ‡</th>
<th>ä¼ ç»Ÿéƒ¨ç½²</th>
<th>Akkaæ–¹æ³•</th>
</tr>
</thead>
<tbody><tr>
<td>æ‰©å±•æ€§</td>
<td>æ··åˆä½¿ç”¨çº¿ç¨‹æ±  å…±äº«æ•°æ®åº“çš„äº’æ–¥çŠ¶æ€,å’ŒRPCç½‘ç»œæœåŠ¡è¿›è¡Œæ‰©å±•</td>
<td>Actor å‘é€å’Œæ¥æ”¶ä¿¡æ¯</td>
</tr>
<tr>
<td>æä¾›äº¤äº’ä¿¡æ¯</td>
<td>å¯¹ä¿¡æ¯è¿›è¡Œè½®è®­</td>
<td>å½“æ—¶é—´å‘ç”Ÿçš„æ—¶å€™è¿›è¡Œæ¨é€</td>
</tr>
<tr>
<td>åœ¨ç½‘ç»œä¸Šè¿›è¡Œæ‰©å±•</td>
<td>åŒæ­¥RPC</td>
<td>å¼‚æ­¥æ¶ˆæ¯.å®Œæˆçš„æ—¶å€™ä¼šé€šè¿‡askå’Œtellæ–¹æ³•è¿›è¡Œç»“æœçš„æ¨é€</td>
</tr>
<tr>
<td>é”™è¯¯å¤„ç†</td>
<td>å¤„ç†æ‰€æœ‰çš„å¼‚å¸¸, åªæœ‰ä¸€åˆ‡æ­£å¸¸æ‰èƒ½ç»§ç»­</td>
<td>éš”ç¦»é”™è¯¯, é€šè¿‡ä¸Šçº§çš„ç›‘ç£ å¯¹å‡ºé”™çš„ä¿¡æ¯åšå¤„ç†</td>
</tr>
</tbody></table>
<h3 id="ä¼ ç»Ÿæ‰©å±•"><a href="#ä¼ ç»Ÿæ‰©å±•" class="headerlink" title="ä¼ ç»Ÿæ‰©å±•"></a>ä¼ ç»Ÿæ‰©å±•</h3><h4 id="ä¼ ç»Ÿæ‰©å±•å’ŒæŒä¹…æ€§-ä¸€åˆ‡ç§»å…¥æ•°æ®åº“"><a href="#ä¼ ç»Ÿæ‰©å±•å’ŒæŒä¹…æ€§-ä¸€åˆ‡ç§»å…¥æ•°æ®åº“" class="headerlink" title="ä¼ ç»Ÿæ‰©å±•å’ŒæŒä¹…æ€§ ä¸€åˆ‡ç§»å…¥æ•°æ®åº“"></a>ä¼ ç»Ÿæ‰©å±•å’ŒæŒä¹…æ€§ ä¸€åˆ‡ç§»å…¥æ•°æ®åº“</h4><p>å¯¹è±¡çš„çŠ¶æ€ä¸å†æ˜¯ç®€å•çš„é©»ç•™åœ¨webæœåŠ¡å™¨çš„å†…å­˜ä¸­äº†, æ“çºµå¯¹è±¡çš„çŠ¶æ€ä¸èƒ½æ˜¯ç®€å•çš„getter/setter è€Œæ˜¯æ•°æ®åº“çš„DDL,DML. å¯¹äºæ•°æ®åº“çš„æ“ä½œè€Œä¸æ˜¯å†…å­˜çš„æ“ä½œä¼šé‡åˆ°ä¸¤ä¸ªé—®é¢˜</p>
<ul>
<li>æ“ä½œæ•°æ®åº“å¯èƒ½ä¼šå¤±è´¥. ç½‘ç»œ æ•°æ®åº“å®•æœº</li>
<li>è¦é€šè¿‡æ•°æ®åº“çš„é”æ¥ä¿è¯æ•°æ®çš„æ­£ç¡®, æ— è®ºæ˜¯å…³ç³»å‹æ•°æ®åº“çš„MMVC, è¿˜æ˜¯Redisçš„ä¹è§‚é”, è¿™æ—¶å€™å°±æ²¡æœ‰ç”¨åˆ°å†…å­˜é”çš„æœºåˆ¶</li>
<li>å¯¹ç¨‹åºåšæµ‹è¯•éœ€è¦åšæ•°æ®çš„éš”ç¦». @Test(transaction=rollback)</li>
</ul>
<h4 id="ä¼ ç»Ÿæ‰©å±•å’Œäº¤äº’åº”ç”¨-è½®è¯¢"><a href="#ä¼ ç»Ÿæ‰©å±•å’Œäº¤äº’åº”ç”¨-è½®è¯¢" class="headerlink" title="ä¼ ç»Ÿæ‰©å±•å’Œäº¤äº’åº”ç”¨ è½®è¯¢"></a>ä¼ ç»Ÿæ‰©å±•å’Œäº¤äº’åº”ç”¨ è½®è¯¢</h4><p>æ¯ä¸ªæ•°æ®åº“çš„å˜åŒ–éœ€è¦JDBCåšDMLæ‰çŸ¥é“å˜åŒ–, ç¨‹åºä¸ä¼šè¢«ä¸»åŠ¨å‘ŠçŸ¥ </p>
<h4 id="ä¼ ç»Ÿæ‰©å±•å’Œäº¤äº’åº”ç”¨-web"><a href="#ä¼ ç»Ÿæ‰©å±•å’Œäº¤äº’åº”ç”¨-web" class="headerlink" title="ä¼ ç»Ÿæ‰©å±•å’Œäº¤äº’åº”ç”¨ web"></a>ä¼ ç»Ÿæ‰©å±•å’Œäº¤äº’åº”ç”¨ web</h4><p>åœ¨ä¸€ä¸ªcontrollerä¸­æˆ‘ä»¬å¯èƒ½ä¼šè°ƒç”¨å…¶ä»–çš„webæœåŠ¡, ç½‘ç»œæ˜¯ä¸å¯é çš„, å¯¹æ–¹çš„æœåŠ¡ä¹Ÿä¸ä¸€å®šå¯é .å¦‚æœè¿œç¨‹çš„æœåŠ¡è°ƒç”¨å¤±è´¥,åˆ™ç¨‹åºä¸­åŒä¸€æµç¨‹ä¸­çš„å…¶ä»–éƒ¨åˆ†ä¹Ÿä¼šå¤±è´¥.</p>
<h3 id="Akkaè¿›è¡Œæ‰©å±•"><a href="#Akkaè¿›è¡Œæ‰©å±•" class="headerlink" title="Akkaè¿›è¡Œæ‰©å±•"></a>Akkaè¿›è¡Œæ‰©å±•</h3><table>
<thead>
<tr>
<th>ç›®æ ‡</th>
<th>ä¼ ç»Ÿæ–¹å¼</th>
<th>Akkaæ–¹å¼</th>
</tr>
</thead>
<tbody><tr>
<td>ä¿æŒæ•°æ®çš„æŒä¹…æ€§</td>
<td>æ‰€æœ‰çš„ç¨‹åºçš„æŒä¹…æ€§éƒ½ç”±æ•°æ®åº“è¿›è¡Œç»´æŠ¤</td>
<td><strong>ç»§ç»­ä½¿ç”¨å†…å­˜ä¸­çš„çŠ¶æ€</strong>æ‰€æœ‰çš„çŠ¶æ€çš„æ”¹å˜ä½œä¸ºæ¶ˆæ¯å‘é€åˆ°æ—¥å¿—. å¦‚æœåº”ç”¨é‡æ–°å¯åŠ¨, éœ€è¦é‡æ–°è¯»å–æ—¥å¿—</td>
</tr>
<tr>
<td>äº¤äº’</td>
<td>å¯¹æ•°æ®åº“è¿›è¡Œè½®è®­</td>
<td>æŠŠäº‹ä»¶æ¨æ¨é€åˆ°ç›¸å…³çš„ç»„å»º</td>
</tr>
</tbody></table>
<p>æœ€å¤§çš„æŒ‘æˆ˜æ˜¯å®‰å…¨çš„ä¿å­˜æ•°æ®.</p>
<h4 id="ç”¨Akkaæ‰©å±•å’ŒæŒä¹…åŒ–"><a href="#ç”¨Akkaæ‰©å±•å’ŒæŒä¹…åŒ–" class="headerlink" title="ç”¨Akkaæ‰©å±•å’ŒæŒä¹…åŒ–"></a>ç”¨Akkaæ‰©å±•å’ŒæŒä¹…åŒ–</h4><h5 id="æ”¹å˜ä¿å­˜ä¸ºäº‹ä»¶åºåˆ—"><a href="#æ”¹å˜ä¿å­˜ä¸ºäº‹ä»¶åºåˆ—" class="headerlink" title="æ”¹å˜ä¿å­˜ä¸ºäº‹ä»¶åºåˆ—"></a>æ”¹å˜ä¿å­˜ä¸ºäº‹ä»¶åºåˆ—</h5><p>æ‰€æœ‰æ›´æ”¹éƒ½ä¿å­˜ä¸ºäº‹ä»¶åºåˆ—, åœ¨æœ¬ä¾‹ä¸­æ˜¯MessageAddedäº‹ä»¶, Coversationçš„å½“å‰çŠ¶æ€å¯ä»¥å›æ”¾åˆ°å†…å®¹ä¸­, Conversation çš„çŠ¶æ€åœ¨å†…å­˜ä¸­è¿›è¡Œé‡å»º,å› æ­¤å¯ä»¥åœ¨ä¸­æ–­çš„åœ°æ–¹ç»§ç»­.è¿™ç§ç±»å‹çš„æ•°æ®åº“é€šå¸¸è¢«ç§°ä¸ºæ˜¯<strong>æ—¥å¿—</strong>, è¿™ç§æŠ€æœ¯é€šå¸¸ä¸ºç§°ä¸ºäº‹ä»¶æº.</p>
<h5 id="ä¼šè¯åˆ†å‰²"><a href="#ä¼šè¯åˆ†å‰²" class="headerlink" title="ä¼šè¯åˆ†å‰²"></a>ä¼šè¯åˆ†å‰²</h5><p>é€šå¸¸é‡‡ç”¨çš„ä½¿ç”¨çš„æŠ€æœ¯æ˜¯ åˆ†ç‰‡ åˆ†åŒº</p>
<h4 id="æ¶ˆæ¯æ¨é€"><a href="#æ¶ˆæ¯æ¨é€" class="headerlink" title="æ¶ˆæ¯æ¨é€"></a>æ¶ˆæ¯æ¨é€</h4><p>äº‹ä»¶é€šè¿‡å‘å¸ƒè®¢é˜…çš„æ–¹å¼è¿›è¡Œæ¨é€, è€Œä¸æ˜¯ç»„ä»¶ä¹‹é—´ç›´æ¥é€šä¿¡.</p>
<h3 id="Actor-æ“ä½œ"><a href="#Actor-æ“ä½œ" class="headerlink" title="Actor æ“ä½œ"></a>Actor æ“ä½œ</h3><ul>
<li>åˆ›å»º</li>
<li>å‘é€</li>
<li>æ”¹å˜</li>
<li>ç›‘ç£</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.andrewchen1.top/2019/04/07/7-%E9%82%AE%E7%AE%B1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="å°å¤«">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¤«çš„ç¬”è®°">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/07/7-%E9%82%AE%E7%AE%B1/" class="post-title-link" itemprop="url">7 é‚®ç®±</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-07 14:33:48" itemprop="dateCreated datePublished" datetime="2019-04-07T14:33:48+08:00">2019-04-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-30 22:15:48" itemprop="dateModified" datetime="2020-08-30T22:15:48+08:00">2020-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Akka%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/" itemprop="url" rel="index"><span itemprop="name">Akkaå…¥é—¨å’Œå®è·µ</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.andrewchen1.top/2019/04/06/6-%E6%A8%AA%E5%90%91%E6%89%A9%E5%B1%95-%E9%9B%86%E7%BE%A4%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="å°å¤«">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¤«çš„ç¬”è®°">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/06/6-%E6%A8%AA%E5%90%91%E6%89%A9%E5%B1%95-%E9%9B%86%E7%BE%A4%E5%8C%96/" class="post-title-link" itemprop="url">6-æ¨ªå‘æ‰©å±• é›†ç¾¤åŒ–</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-06 16:01:17" itemprop="dateCreated datePublished" datetime="2019-04-06T16:01:17+08:00">2019-04-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-30 22:15:54" itemprop="dateModified" datetime="2020-08-30T22:15:54+08:00">2020-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Akka%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%9E%E8%B7%B5/" itemprop="url" rel="index"><span itemprop="name">Akkaå…¥é—¨å’Œå®è·µ</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="æ¨ªå‘æ‰©å±•-é›†ç¾¤åŒ–"><a href="#æ¨ªå‘æ‰©å±•-é›†ç¾¤åŒ–" class="headerlink" title="æ¨ªå‘æ‰©å±• é›†ç¾¤åŒ–"></a>æ¨ªå‘æ‰©å±• é›†ç¾¤åŒ–</h1><h2 id="ä¸ºä»€ä¹ˆè¦å¾®æœåŠ¡åŒ–"><a href="#ä¸ºä»€ä¹ˆè¦å¾®æœåŠ¡åŒ–" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å¾®æœåŠ¡åŒ–"></a>ä¸ºä»€ä¹ˆè¦å¾®æœåŠ¡åŒ–</h2><ol>
<li>å•æœºèƒ½æä¾›çš„èµ„æºæœ‰é™(primary)</li>
</ol>
<p>ä¸€ä¸ªç‰©ç†æœºå™¨çš„ç¡¬ä»¶èµ„æº,ç½‘ç»œèµ„æºæ€»æ˜¯æœ‰é™çš„, å¯èƒ½éœ€è¦å¤šä¸ªæœºå™¨æ‰èƒ½æ”¯æŒéœ€æ±‚.å¹¶ä¸”åœ¨GCçš„æ—¶å€™å¯èƒ½ä¼šstop the world. å°†å…¶ä½™çš„çº¿ç¨‹æš‚åœ, GCçº¿ç¨‹å¯åŠ¨, å¯¹EdenåŒºçš„å¯¹è±¡åšè¿é€šçš„è®¡ç®—. å¯¹è±¡ç›®å‰æ˜¯å­˜æ´»å¯¹è±¡çš„å›¾çš„äºˆä»¥ä¿ç•™, å¯¹äºåœ¨ä¸åœ¨çš„äºˆä»¥æ¸…ç†.å¦‚æœSurviceçš„ç©ºé—´å¾ˆå¤§çš„è¯ é‚£stop the world æ‰€éœ€è¦çš„æ—¶é—´ä¹Ÿå°±ä¼šå¾ˆé•¿, å¯¼è‡´ä¸šåŠ¡æš‚åœçš„æ—¶é—´ä¹Ÿä¼šå»¶é•¿.</p>
<ol start="2">
<li>æ–¹ä¾¿é¡¹ç›®ç®¡ç†ã€å‘å¸ƒæµ‹è¯•ç­‰çš„æµç¨‹çš„è¿›è¡Œ(secondary)</li>
</ol>
<h2 id="é›†ç¾¤å’Œé›†ç¾¤å†…éƒ¨èŠ‚ç‚¹çš„çŠ¶æ€"><a href="#é›†ç¾¤å’Œé›†ç¾¤å†…éƒ¨èŠ‚ç‚¹çš„çŠ¶æ€" class="headerlink" title="é›†ç¾¤å’Œé›†ç¾¤å†…éƒ¨èŠ‚ç‚¹çš„çŠ¶æ€"></a>é›†ç¾¤å’Œé›†ç¾¤å†…éƒ¨èŠ‚ç‚¹çš„çŠ¶æ€</h2><p>é›†ç¾¤å°±æ˜¯ä¸€ç»„å¯ä»¥äº’ç›¸é€šä¿¡çš„æœåŠ¡å™¨, ä»–ä»¬å‘å¤–ç•Œé€æ˜çš„æä¾›ä¸€è‡´æœåŠ¡. é›†ç¾¤å¯ä»¥åŠ¨æ€çš„ä¿®æ”¹å¤§å°, å¹¶ä¸”åœ¨å‘ç”Ÿé”™è¯¯çš„æ—¶å€™æ—¶å€™ç»§ç»­è¿è¡Œ.é›†ç¾¤éœ€è¦å…·å¤‡ä¸¤ä¸ªåŠŸèƒ½</p>
<ol>
<li>å‘ç°å¤±è´¥</li>
<li>é›†ç¾¤ä¸­çš„æ‰€æœ‰æˆå‘˜æœ€ç»ˆèƒ½æä¾›ç»Ÿä¸€çš„è§†å›¾</li>
</ol>
<p>###å¤±è´¥æ£€æµ‹</p>
<p>æˆ‘ä»¬è¦çŸ¥é“é›†ç¾¤ä¸­é‚£äº›èŠ‚ç‚¹ç°åœ¨å¤„äºä¸èƒ½æœåŠ¡çš„çŠ¶æ€, æˆ‘ä»¬å°±ä¸æŠŠä»»åŠ¡åˆ†é…ç»™è¿™äº›èŠ‚ç‚¹äº†.åœ¨è¿™é‡Œæœ‰è‹¥å¹²çš„ç®—æ³•å¯ä»¥ä½¿ç”¨, ä»¥ä¸‹å†…å®¹æŠ„è¢­è‡ª<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/e72e3b208a0b">åˆ†å¸ƒå¼ä¸­å‡ ç§æœåŠ¡æ³¨å†Œä¸å‘ç°ç»„ä»¶çš„åŸç†ä¸æ¯”è¾ƒ</a></p>
<ol>
<li><p>Eureka</p>
<p>èŠ‚ç‚¹å®šæ—¶ç»™æ³¨å†Œä¸­å¿ƒå‘é€å¿ƒè·³è¿›è¡Œæ³¨å†Œ, å®ƒä¼šå‘ŠçŸ¥æœåŠ¡ä¸­å¿ƒè‡ªå·±çš„ip port ä»¥åŠè‡ªå·±çš„service-id (èƒ½æä¾›æ€æ ·çš„æœåŠ¡). æ³¨å†Œä¸­å¿ƒåœ¨å“åº”èŠ‚ç‚¹è¯·æ±‚çš„æ—¶å€™å‘Šè¯‰èŠ‚ç‚¹ç›®å‰é›†ç¾¤ä¸­å­˜åœ¨çš„å…¶ä»–èŠ‚ç‚¹çš„ä¿¡æ¯.</p>
<p>Eurekaä¸­æ²¡æœ‰ä½¿ç”¨ä»»ä½•çš„æ•°æ®å¼ºä¸€è‡´æ€§ç®—æ³•ä¿è¯ä¸åŒé›†ç¾¤é—´çš„Serverçš„æ•°æ®ä¸€è‡´ï¼Œä»…é€šè¿‡æ•°æ®æ‹·è´çš„æ–¹å¼äº‰å–æ³¨å†Œä¸­å¿ƒæ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œè™½ç„¶æ”¾å¼ƒæ•°æ®å¼ºä¸€è‡´æ€§ä½†æ˜¯æ¢æ¥äº†Serverçš„å¯ç”¨æ€§ï¼Œé™ä½äº†æ³¨å†Œçš„ä»£ä»·ï¼Œæé«˜äº†é›†ç¾¤è¿è¡Œçš„å¥å£®æ€§ã€‚</p>
</li>
<li><p>Consul</p>
<p>Consulæä¾›å¼ºå¤§çš„ä¸€è‡´æ€§ä¿è¯ï¼Œå› ä¸ºæœåŠ¡å™¨ä½¿ç”¨Raftåè®®å¤åˆ¶çŠ¶æ€ ã€‚Consulæ”¯æŒä¸°å¯Œçš„å¥åº·æ£€æŸ¥ï¼ŒåŒ…æ‹¬TCPï¼ŒHTTPï¼ŒNagios / Sensuå…¼å®¹è„šæœ¬æˆ–åŸºäºEurekaçš„TTLã€‚å®¢æˆ·ç«¯èŠ‚ç‚¹å‚ä¸åŸºäºå…«å¦çš„å¥åº·æ£€æŸ¥ï¼Œè¯¥æ£€æŸ¥åˆ†å‘å¥åº·æ£€æŸ¥å·¥ä½œï¼Œè€Œä¸åƒé›†ä¸­å¼å¿ƒè·³æ£€æµ‹é‚£æ ·æˆä¸ºå¯æ‰©å±•æ€§æŒ‘æˆ˜ã€‚å‘ç°è¯·æ±‚è¢«è·¯ç”±åˆ°é€‰ä¸¾å‡ºæ¥çš„é¢†äº‹é¢†å¯¼ï¼Œè¿™ä½¿ä»–ä»¬é»˜è®¤æƒ…å†µä¸‹å¼ºçƒˆä¸€è‡´ã€‚å…è®¸é™ˆæ—§è¯»å–çš„å®¢æˆ·ç«¯ä½¿ä»»ä½•æœåŠ¡å™¨éƒ½å¯ä»¥å¤„ç†ä»–ä»¬çš„è¯·æ±‚ï¼Œä»è€Œå®ç°åƒEurekaè¿™æ ·çš„çº¿æ€§å¯ä¼¸ç¼©æ€§.</p>
<p>å†…éƒ¨æœ‰è‹¥å¹²çš„è§’è‰²</p>
<ul>
<li><p>Clientï¼šä½œä¸ºä¸€ä¸ªä»£ç†(éå¾®æœåŠ¡å®ä¾‹)ï¼Œå®ƒå°†è½¬å‘æ‰€æœ‰çš„RPCè¯·æ±‚åˆ°Serverä¸­ã€‚ä½œä¸ºç›¸å¯¹æ— çŠ¶æ€çš„æœåŠ¡ï¼Œå®ƒä¸æŒæœ‰ä»»ä½•æ³¨å†Œä¿¡æ¯ã€‚</p>
</li>
<li><p>Serverï¼šä½œä¸ºä¸€ä¸ªå…·å¤‡æ‰©å±•åŠŸèƒ½çš„ä»£ç†ï¼Œå®ƒå°†å“åº”RPCæŸ¥è¯¢ã€å‚ä¸Rafté€‰ä¸¾ã€ç»´æŠ¤é›†ç¾¤çŠ¶æ€å’Œè½¬å‘æŸ¥è¯¢ç»™Leaderç­‰ã€‚</p>
</li>
<li><p>Leader-Serverï¼šä¸€ä¸ªæ•°æ®ä¸­å¿ƒçš„æ‰€æœ‰Serveréƒ½ä½œä¸ºRaftèŠ‚ç‚¹é›†åˆçš„ä¸€éƒ¨åˆ†ã€‚å…¶ä¸­Leaderå°†è´Ÿè´£æ‰€æœ‰çš„æŸ¥è¯¢å’Œäº‹åŠ¡(å¦‚æœåŠ¡æ³¨å†Œ)ï¼ŒåŒæ—¶è¿™äº›äº‹åŠ¡ä¹Ÿä¼šè¢«å¤åˆ¶åˆ°æ‰€æœ‰å…¶ä»–çš„èŠ‚ç‚¹ã€‚</p>
</li>
<li><p>Data Centerï¼šæ•°æ®ä¸­å¿ƒä½œä¸ºä¸€ä¸ªç§æœ‰çš„ï¼Œä½å»¶è¿Ÿå’Œé«˜å¸¦å®½çš„ä¸€ä¸ªç½‘ç»œç¯å¢ƒã€‚æ¯ä¸ªæ•°æ®ä¸­å¿ƒä¼šå­˜åœ¨Consulé›†ç¾¤ï¼Œä¸€èˆ¬å»ºè®®Serveræ˜¯3-5å°(è€ƒè™‘åˆ°Raftç®—æ³•åœ¨å¯ç”¨æ€§å’Œæ€§èƒ½ä¸Šå–èˆ)ï¼Œè€ŒLeaderåªèƒ½å”¯ä¸€ï¼ŒClientçš„æ•°é‡æ²¡æœ‰é™åˆ¶ï¼Œå¯ä»¥è½»æ¾æ‰©å±•ã€‚</p>
</li>
</ul>
</li>
</ol>
<p>æ‰€æœ‰çš„è¦æ±‚é—®è¯¢é›†ç¾¤ä¸­çŠ¶æ€çš„è¯·æ±‚éƒ½ä¼šè¢«å‘é€åˆ°client. Client ä¸å­˜å‚¨ä»»ä½•é›†ç¾¤çš„çš„ä¿¡æ¯. å®ƒä¼šæŠŠè¯·æ±‚è½¬å‘ç»™Server.Clientä¹‹é—´é€šè¿‡gossip æ¥çŸ¥æ™“ç›®å‰é›†ç¾¤ä¸­èƒ½å¤ŸæœåŠ¡çš„Serveræœ‰å“ªäº›.ç„¶åè¯·æ±‚ä»»ä½•ä¸€ä¸ªèƒ½å¤ŸæœåŠ¡çš„Server.</p>
<p>Serveråˆ†ä¸ºLeader Server å’Œ Follower Server. Follower Server åªæ˜¯Leaderçš„copy. æ‰€æœ‰çš„äº‹åŠ¡ä¿¡æ¯éƒ½æ˜¯è¢«Leaderè®°å½• ç„¶åé€šçŸ¥åˆ°Followerçš„. è¿™é‡Œç”±Raftç®—æ³•æä¾›ä¸€è‡´æ€§ä¿è¯.</p>
<p><img src="http://img.andrewchen1.top/%E5%B0%8F%E4%B9%A6%E5%8C%A0/7891228-fbea40230f4c5738.png" alt="ç¤ºæ„å›¾"></p>
<ol start="3">
<li>Zookeeper</li>
</ol>
<ul>
<li><p>Leader-Serverï¼šLeaderè´Ÿè´£è¿›è¡ŒæŠ•ç¥¨çš„å‘èµ·å’Œå†³è®®ï¼Œæ›´æ–°ç³»ç»Ÿä¸­çš„æ•°æ®çŠ¶æ€</p>
</li>
<li><p>Serverï¼šServerä¸­å­˜åœ¨ä¸¤ç§ç±»å‹ï¼šFollowerå’ŒObserverã€‚å…¶ä¸­Followeræ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶è¿”å›ç»“æœ(äº‹åŠ¡è¯·æ±‚å°†è½¬å‘ç»™Leaderå¤„ç†)ï¼Œå¹¶åœ¨é€‰ä¸¾è¿‡ç¨‹ä¸­å‚ä¸æŠ•ç¥¨ï¼›Observerä¸FolloweråŠŸèƒ½ä¸€è‡´ï¼Œä½†æ˜¯ä¸å‚ä¸æŠ•ç¥¨è¿‡ç¨‹ï¼Œå®ƒçš„å­˜åœ¨æ˜¯ä¸ºäº†æé«˜ç³»ç»Ÿçš„è¯»å–é€Ÿåº¦</p>
</li>
<li><p>Clientï¼šè¯·æ±‚å‘èµ·æ–¹ï¼ŒServerå’ŒClientä¹‹é—´å¯ä»¥é€šè¿‡é•¿è¿æ¥çš„æ–¹å¼è¿›è¡Œäº¤äº’ã€‚å¦‚å‘èµ·æ³¨å†Œæˆ–è€…è¯·æ±‚é›†ç¾¤ä¿¡æ¯ç­‰ã€‚</p>
</li>
</ul>
<p>åœ¨Akka cluster ä¸­æ˜¯é€šè¿‡Gossip åè®®æ¥åŒæ­¥äº‹åŠ¡çš„çŠ¶æ€çš„. æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šç›‘æ§å®ƒåé¢çš„èŠ‚ç‚¹(é»˜è®¤æœ€å¤§ç›‘æ§æ•°é‡æ˜¯5). ç„¶åâ€é‚»å±…â€æŠŠè‡ªå·±æ‰€çŸ¥é“çš„æƒ…å†µå‘Šè¯‰è‡ªå·±çš„â€é‚»å±…â€ ç„¶åæ•´ä¸ªèŠ‚ç‚¹éƒ½çŸ¥é“äº†.</p>
<h3 id="CAP"><a href="#CAP" class="headerlink" title="CAP"></a>CAP</h3><p>cä¸ºConsistency ä¸€è‡´æ€§. Aä¸ºAvailable å¯ç”¨æ€§. Pä¸ºPartition Tolerance åˆ†åŒºå®¹é”™æ€§. å› ä¸ºç³»ç»Ÿæ˜¯ä¸ç¨³å®šçš„, è‚¯å®šæ˜¯ä¼šPçš„.CAP å…¶å®å°±æ˜¯å‘ç”Ÿäº†ä¸ä¸€è‡´çš„æƒ…å†µP, æ˜¯è¦Cè¿˜æ˜¯è¦A. å¯¹äºä¸€ä¸ªäº‹æƒ…, æ¯”æ–¹è¯´æ‰£è´¦æˆ·é‡Œé¢çš„ä½™é¢, å‡åº“å­˜. å½“å‘ç”Ÿäº†è¯·æ±‚æ‰£ä½™é¢çš„åŠ¨ä½œè¶…æ—¶çš„æ—¶å€™, æˆ‘ä»¬è¦æ€ä¹ˆåš. å‡åº“å­˜é‚£å°±æ˜¯é€‰æ‹©äº†A, å¦‚æœæ˜¯æŠ¥é”™å°±æ˜¯é€‰æ‹©äº†C.</p>
<ul>
<li><p>CP</p>
<p>æ¯”æ–¹è¯´ä¸€ä¸ªç³»ç»Ÿæœ‰ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“.leaderå’Œè‹¥å¹²ä¸ªfollower. followeré€šè¿‡è¯»leaderçš„bin log æ¥å®ç°æ•°æ®çš„åŒæ­¥. å½“leaderä¸èƒ½å·¥ä½œçš„æ—¶å€™,é‚£ä¹ˆæ•´ä¸ªç³»ç»Ÿä¹Ÿå°±ä¸èƒ½å¤„ç†è¯·æ±‚äº†. è¿™ä¸ªç³»ç»Ÿæ˜¯æ˜¯CPçš„.</p>
</li>
<li><p>AP</p>
<p>æ¯”æ–¹è¯´æœ‰ä¸€ä¸ªå­˜å‚¨å•å…ƒ, é‡Œé¢æœ‰ä¸‰ä¸ªèŠ‚ç‚¹,ä»–ä»¬éƒ½æ˜¯äº’ç›¸ç‹¬ç«‹çš„,æˆ‘ä»¬å¯ä»¥è®¿é—®å½“ä¸­çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹æ¥è·å–æ•°æ®.å³ä½¿ä¸€ä¸ªä¸èƒ½å·¥ä½œäº†,æˆ‘ä»¬å¯ä»¥è®¿é—®å…¶ä»–ä»»æ„ä¸€ä¸ªæ¥è·å¾—æ•°æ®.</p>
</li>
<li><p>CPå’ŒAPçš„ç€é‡ç¨‹åº¦æ˜¯å¯ä»¥è½¬å˜çš„</p>
<p>æ¯”æ–¹è¯´å¯¹äºä¹‹å‰CPçš„æƒ…å†µ,æˆ‘ä»¬å¯ä»¥æŠŠfollowerå½“ä½œæ˜¯è¯»åº“, Leader å½“ä½œæ˜¯å†™åº“, é€šè¿‡ä¹è§‚é”æ¥ä¿è¯æœ€ç»ˆä¸€è‡´æ€§.(update çš„æ•°é‡å’ŒæœŸæœ›çš„ä¸€è‡´, å¦åˆ™å°±è¯´æ˜è¿™ä¸ªæ•°æ®ä»followerä¸­æ‹¿åˆ°çš„ä¸æ˜¯æœ€æ–°çš„, æŠ›é”™). å¯¹äºAPçš„æƒ…å†µæ¯”æ–¹è¯´å½“ä¸­çš„æŸä¸ªæ•°æ®æ˜¯éœ€è¦è¢«è¶…è¿‡1/2èŠ‚ç‚¹æ‰€è®¤å¯çš„.</p>
</li>
</ul>
<h3 id="Akka-Cluster"><a href="#Akka-Cluster" class="headerlink" title="Akka Cluster"></a>Akka Cluster</h3><h4 id="åˆ†åŒºä¸çº¿æ€§æ‰©å±•"><a href="#åˆ†åŒºä¸çº¿æ€§æ‰©å±•" class="headerlink" title="åˆ†åŒºä¸çº¿æ€§æ‰©å±•"></a>åˆ†åŒºä¸çº¿æ€§æ‰©å±•</h4><p>é€šè¿‡hash mode x = næ¥è®¡ç®—ç»“æœå­˜æ”¾åœ¨å“ªä¸ªèŠ‚ç‚¹, å¯¹äºè¿™ä¸ªxå¯ä»¥é€‚å½“çš„å¤§äºç›®å‰çš„å€¼, æ¯”æ–¹è¯´64 æˆ–è€…128 ç„¶åå®šä¹‰ç»“æœåœ¨[a-b) ä¹‹é—´çš„åˆ†é…åˆ° 1 , [b-c) ä¹‹é—´åˆ†é…åˆ°2.</p>
<h4 id="èŠ‚ç‚¹å†—ä½™"><a href="#èŠ‚ç‚¹å†—ä½™" class="headerlink" title="èŠ‚ç‚¹å†—ä½™"></a>èŠ‚ç‚¹å†—ä½™</h4><p>è¯»å–è¯·æ±‚ä¼šå‘é€åˆ°ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹,è¯¥èŠ‚ç‚¹è´Ÿè´£è¿›è¡Œåè°ƒ, è®¡ç®— partition keyçš„å“ˆå¸Œå€¼, ç„¶åæŠŠè¯·æ±‚å‘é€ç»™å®é™…å­˜å‚¨æ•°æ®çš„3ä¸ªèŠ‚ç‚¹, å½“è‡³å°‘ä¸¤ä¸ªèŠ‚ç‚¹è¿”å›ç»“æœæˆåŠŸ,å³æˆåŠŸ.</p>
<h3 id="è·å–Identity"><a href="#è·å–Identity" class="headerlink" title="è·å–Identity"></a>è·å–Identity</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Identify identify = <span class="keyword">new</span> Identify(<span class="number">1</span>);</span><br><span class="line">Future future = ask(selection, identify, <span class="number">1000</span>);</span><br><span class="line"><span class="keyword">return</span> (ActorIdentity)Await.result(future, timeout.duration());</span><br></pre></td></tr></table></figure>








      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="å°å¤«"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">å°å¤«</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/andrewchen1" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;andrewchen1" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:andrewchen7@outlook.com" title="E-Mail â†’ mailto:andrewchen7@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/312228489" title="Weibo â†’ https:&#x2F;&#x2F;weibo.com&#x2F;312228489" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">æµ™ICPå¤‡18051892å· </a>
  </div>

<div class="copyright">
  
  &copy; 2018 â€“ 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å°å¤«</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
